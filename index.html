<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="icon" type="image/png"
		href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAC91BMVEUAAAAsIylCOj9VTlI1JyhBOTy1n5EvJCZJPEM3LjUlHR85LzhdUFU/MDInHiNBNDc6MTc1LDFWSkU/NjoZFhkeFxijfVk9LS8vJCxnW195al4uJSkyJyo/Mjc8MjgeFxwZERFCOUATERNlXV3y47F2XVRCN0Oukmbn2sBwZGQpHiHGuZQ7LCzLwalIODouJSYpICB3XkjBvKNFNDQqISKWiXaqm5UZExVmVlofGh8fFxlpUUGBe3hYUU1jXmT/6dBUPj5LNzlEMjM7KyxpTktOOjtALzBvUlFQOzx8XldFLjU0JiiFZFxHNTYxIyT++uz/5s3+4clpXWiLaF5bQkE2Jyz9893/69Lx5cv228X52sTl1b/eybOTi42gioWJfoSWdm5uY2pvYF2CYVlsWlluVExkTEpeRURXQkA9NUBoQT00LDlBLzdSNTYmIS8rICH69Obs6OPi3Nf36c/e1c7QysjOxcDEvLi5sK65pZqyi32TgH1/dnmAc3Cvd2yTb2OMbGOabWCdZ1xaTlx/XFmUZ1hRSFZkUlV6VVOIa1FeUVF2VE1iSUE4MD5HOjtjOzZkLTY3LDMkGh3+/PH49e/+/OT++t/n4dz38Nbx6dP99tL69Mrc18Pz5cD+9r3Qybrp2rXNvbXbwrDauqjluqVdjJbx1pXYv5Kjj4/lm4zIpouumYumlYbUkIXDiXyvlHFtZm+jcmuee2qlh2izbGekbGZ9a2VgVWSNd2OdhWBzZGCHaFt9ZlR3WFSEW1OqU1J7YlGCUUpOQUd0WkWIXkNoSUNrVUKYOUF2UDwsJDRMMDA4Iyv27eDo4dLl3NLl2Mj25sXq2sLuzrr877asvLWbs7C9uaL98KG/rqHiyp6vpZ3Xxpy/rpmXhJCwm47TsYzOmoq5k4W6poSThYKUg4LcwIF+cHaNgHSGf3O6fXKbiG+pgW9/a2y3hlqocVpLRlkzS1d0XFVrWVSccEuMUUu5QkqESkhiSUcwPUdyW0ajPESUS0OJNT5j/bk9AAAAP3RSTlMA/h0L70/+8ikQ9O/st6qJal9KSC8U/fjl5OPUspx4aEg8PDT+/fz49vHx6enf39ra1s3IxK2bmI2HhIB+Y1QrMBUfAAAC80lEQVQ4y2KgMmAVVlAQZWLFIatkziftHerNIq4jKMqMRZ7Jissrx8nVwcHXyc2bF1NeUcLb2cnV0dc13cPJ14FFGV2emc/by8vZ1cOhZa+Dq5ujBwu6Q/gZ3dxcQ9xdgt3TXBzcHdKdnXlRDFECiJHRycE3w8PJ3aU+YZNLaqpvqACKAfImbq6ODsmpe7+7uFf5JO/28XC0RFHAwe7l6JDu5OZZ7+7p6b7Jx8XDWUsESZ6Tj3GiY4ijS4hncLrP6+DkFncPLwFkBaLSjKHOzhlHu4N3N3R0dNc/9HF0skD2o7ws46R8x4yQjuQlCSFZ6xbdc3F05kcNRsZJ3n6hrhP7gh2c9jWkLPZwY0ENbQFGRj+/NLalS3e5uTz48aHLyc8ANZwAEubOT/NNK54/5/mqS4FXrsY453OhxZQgl2uLY3RYcXS4vb19QMwkb1YmtLDWz3fyWRxuH24fBcRr/Nit0WNLht3ZISoAqD0KiD+xGIsJgcIHyaVCcuJ+DYEBkZGRAfZsejKGKepAFXIcikihKct+qioqMBAozy3xs703Q1VQWJJVEuxCU20jO2B88Gc1bVwSGFkVmndsx6GTeZ5qPDWaPCCtUo8WTJttw8DMe+Ldy60bG1uP9a1Pyj6ZyZOYWFNbysBhBggFAfr+LaDldHGdJD0Uy0qKFq2ufrXDwLZpawtSg11fd3d1AChYlZrTT3Ccp9sakZCQarSprX6PwIaNbEaOUl1ddnZ4AFiTT57Xm3CYrLjW74ZskPy0qb/K8WmNbG1tSrZ4cpeXAFiUT5Wek3Od3GLosLC3xPv69cePiWluy8WPbYxecpRxAJnOT0+aVqamq2S6UmHme7Ptv8fIh7lrbYWBasK8oXdxAFh0VlaW0Keze1Jihnzj5Hl76rmMg2S8i9+qhYqJ2HJ2AFtc0Vtcr4lgmdpig1+feKLdqEnD7GFJwdl+gmtlq3R1AM8GXl5gxF7NcMx9Ul+YeXmhqIHz9Ie3voL2wW6MfV1fBUcTM3p5mhoAAAAASUVORK5CYII=" />
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&family=Noto+Sans+KR:wght@100..900&family=Noto+Sans+SC:wght@100..900&family=Noto+Sans+Symbols:wght@100..900&family=Noto+Sans+TC:wght@100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap"
		rel="stylesheet">
	<title data-i18n="SiteTitle">Evertale Encyclopedia</title>
	<style>
		html {
			font-family: "Helvetica Neue", "Microsoft JhengHei", "PingFang TC", "Segoe UI", sans-serif;
		}

		body {
			width: min(100%, 800px);
			margin: auto;
			padding: 0.5rem;
			box-sizing: border-box;
		}

		input,
		button,
		select,
		option {
			font-family: inherit;
		}

		[lang="en"],
		[lang="fr"],
		[lang="de"],
		[lang="it"],
		[lang="es"] {
			font-family: "Noto Sans", "Noto Sans Symbols", sans-serif;
		}

		[lang="zh-Hant"] {
			font-family: "Noto Sans TC", "Noto Sans Symbols", sans-serif;
		}

		[lang="zh-Hans"] {
			font-family: "Noto Sans SC", "Noto Sans Symbols", sans-serif;
		}

		[lang="ja"] {
			font-family: "Noto Sans JP", "Noto Sans Symbols", sans-serif;
		}

		[lang="ko"] {
			font-family: "Noto Sans KR", "Noto Sans Symbols", sans-serif;
		}

		a {
			color: inherit;
			text-decoration: none;
		}

		#languagePick {
			display: block;
			margin: 0.5em auto;
			font-size: 1.2em;
			width: max(50%, 10em);
			padding: 5px;
		}

		.chooseOption {
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 3px 0;
		}

		.chooseOption label {
			flex: 1;
			text-align: center;
		}

		#filterArea label,
		.textFilterOptionGroup {
			display: inline-flex;
			align-items: center;
			justify-content: center;
		}

		#filterArea img {
			height: 1.2em;
		}

		#filterRarity,
		#filterElement,
		#filterWeaponType,
		#filterStars,
		#filterText {
			border: 1px solid black;
			margin: 5px 0;
			padding: 5px;
			position: relative;
		}

		#filterText>div {
			position: relative;
		}

		#filterTextInputZone {
			display: flex;
			gap: 5px;
		}

		#filterTextInput {
			text-align: center;
			display: block;
			box-sizing: border-box;
			width: 100%;
			font-size: 1em;
		}

		#useRegex {
			position: absolute;
			right: 5px;
			border: 1px solid black;
			align-self: center;
			border-radius: 5px;
			font-size: 0.8em;
		}

		#useRegex:has(input:checked) {
			background-color: lightblue;
		}

		#filterText button {
			background-color: transparent;
			border: 0;
			padding: 0;
			font-size: 1em;
		}

		#filterText input[type="checkbox"] {
			appearance: none;
			margin: 0;
			opacity: 0;
			position: absolute;
			width: 0;
			height: 0;
		}

		#filterTextOption {
			margin-top: 5px;
			margin-left: 5px;
			display: grid;
			grid-template-columns: auto auto;
			width: fit-content;
			max-width: 100%;
			gap: 3px 1em;
		}

		.textFilterOptionGroup {
			display: flex;
			align-items: center;
			justify-content: start;
			gap: 3px;
			line-height: 0.8em;
			font-size: 0.8em;
			flex-wrap: wrap;
		}

		.textFilterOptionGroup span {
			padding: 5px;
			border: 1px dotted black;
		}

		.textFilterOptionGroup input:checked+span {
			background-color: gray;
			color: white;
		}

		.toggleAll {
			position: absolute;
			top: 0;
			left: -0.4em;
			border: none;
			background: transparent;
			width: max(3%, 1em);
			height: 100%;
			padding: 0;
			font: inherit;
		}

		.toggleAll::before {
			position: absolute;
			content: "";
			top: 50%;
			left: 0;
			background-color: gray;
			border-radius: 50%;
			width: 0.8em;
			height: 1.2em;
			transform: translateY(-50%);
		}

		#targetSelect {
			width: 100%;
			height: 2em;
			margin: 10px auto;
			font-size: 1em;
			font-family: inherit;
		}

		select {
			appearance: none;
			-webkit-appearance: none;
			-moz-appearance: none;
			text-align: center;
			text-align-last: center;
			-moz-text-align-last: center;
		}

		option:first-child {
			text-align: center;
			text-align-last: center;
			-moz-text-align-last: center;
		}

		option:not(:first-child) {
			text-align: left;
		}

		.hidden {
			display: none !important;
		}

		hr {
			margin: 1.5em -0.5em 2em -0.5em;
		}

		#bigName {
			text-align: center;
			font-size: 3em;
			font-weight: bold;
			overflow-x: auto;
		}

		#subName {
			text-align: center;
			font-size: 1.5em;
			overflow-x: auto;
		}

		#codeName {
			font-size: 0.5em;
			text-align: right;
			padding-bottom: 1.5rem;
		}

		#viewContent {
			padding: 0.5em;
			margin-top: 2em;
		}

		#generalStatsArea {
			width: min(100%, 400px);
			margin: auto;
			padding: 0 0.5rem;
			border: 1px solid black;
			box-sizing: border-box;
		}

		#headshotZone {
			display: flex;
			justify-content: center;
			gap: 0.5em;
			margin: 0.5em;
		}

		.headshotBox {
			display: inline-block;
			width: 100px;
			max-width: 50%;
			aspect-ratio: 1 / 1;
			object-fit: contain;
			object-position: center;
			/*border-radius: 10px;
			border: 1px solid black;*/
			overflow: hidden;
		}

		.headshotBox img {
			display: block;
			width: 100%;
			max-width: 100%;
			height: 100%;
			max-height: 100%;
			object-fit: contain;
			object-position: center;
		}

		.infoRow {
			display: flex;
			align-items: center;
			margin: 0.5rem auto;
		}

		.infoTitle {
			width: 80%;
			border: 1px solid black;
			text-align: center;
			padding: 0.2em;
		}

		html[lang^="zh"] .infoTitle {
			width: 30%;
			text-align: justify;
			text-align-last: justify;
		}

		html[lang="zh-Hant"] #cost .infoTitle {
			text-align: center;
			text-align-last: center;
		}

		.infoValue {
			width: 70%;
			text-align: center;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.infoValue img {
			height: 1.5em;
			vertical-align: middle;
		}

		#stars img {
			height: 1.2em;
		}

		#freeEvo .infoValue {
			display: block;
		}

		.areaTitle {
			text-align: center;
			font-size: 2em;
		}

		.contentBox {
			position: relative;
			border: 1px solid black;
			padding: 0.5em;
			min-height: 1.5em;
			box-sizing: border-box;
		}

		#hasAscended {
			margin-top: 1.5em;
		}

		#profileAscendedTitle {
			border: 1px solid black;
			font-size: 1.2em;
			width: 50%;
			text-align: center;
			text-align-last: center;
			margin: 0.5em auto;
		}

		html[lang^="zh"] #profileAscendedTitle,
		html[lang="ja"] #profileAscendedTitle {
			text-align: justify;
			text-align-last: justify;
		}

		#profileAscendedTitle::before,
		#profileAscendedTitle::after {
			content: "";
			display: inline-block;
		}

		#leaderSkillName,
		#weaponSkillName {
			border: 1px solid black;
			display: inline-block;
			margin: 0 auto 0.3em 1em;
			padding: 0 0.2em;
		}

		#activeSkillContent,
		#passiveSkillContent,
		#dialogContent,
		#relationshipContent {
			display: flex;
			flex-direction: column;
			gap: 0.5em;
		}

		.activeSkillDetail,
		.passiveSkillDetail {
			display: grid;
			grid-template-columns: 1fr minmax(10%, max-content) minmax(10%, max-content);
			align-items: center;
			border: 1px solid black;
			padding: 0.5em;
			gap: 0.4em;
		}

		.activeSkillName,
		.passiveSkillName,
		.relationshipName {
			display: inline-block;
			margin-left: 1em;
			border: 1px solid black;
			padding: 0 0.2em;
			width: fit-content;
		}

		.activeSkillDetail img {
			height: 1.2em;
		}

		.activeSkillSpirit,
		.activeSkillTU {
			text-align: center;
			border: 1px solid black;
			border-radius: 1em;
			height: 100%;
			padding: 0 0.5em;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.activeSkillDecription,
		.passiveSkillDecription,
		.relationshipMembers {
			grid-column: 1 / -1;
		}

		#summonableMonstersContent img,
		#relationshipContent img {
			vertical-align: middle;
			height: 2em;
			margin-right: 0.5em;
		}

		#dialogContent {
			gap: 1em;
		}

		.dialogGroupTitle {
			text-align: center;
			font-size: 1.2em;
		}

		.dialogText {
			border: 1px solid black;
			margin-top: 0.5em;
			padding: 0.5em;
		}

		label:has(input:disabled) {
			opacity: 0.5;
			pointer-events: none;
			cursor: not-allowed;
		}

		#aiLogicContent {
			white-space: pre;
			overflow-x: auto;
		}

		.relationshipAGroup {
			display: grid;
			grid-template-columns: 1fr 5em;
			align-items: center;
			border: 1px solid black;
			padding: 0.5em;
		}

		.relationshipBonus {
			text-align: center;
			border: 1px solid black;
			border-radius: 5em;
			height: 100%;
			place-content: center;
			padding: 0 0.5em;
			line-height: 1.1;
		}

		.relationshipAGroup ul {
			margin: 0.5em 1em;
			padding-left: 0.5em;
		}

		.collapseButton {
			position: absolute;
			left: 0;
			top: -0.25rem;
			background-color: transparent;
			border: 0;
			padding: 0;
			line-height: 1;
			transform: translate(-50%, -100%);
		}

		#dataProgress table * {
			border: 1px solid black;
		}

		#dataProgress table {
			border-collapse: collapse;
			border: 1px solid black;
			width: min(100%, 400px);
			margin: auto;
			text-align: center;
		}

		#selectableList {
			display: grid;
			grid-template-columns: 1fr auto;
			align-items: center;
		}

		#siteSetting {
			font-size: 0.8em;
			display: grid;
			grid-template-columns: 1fr auto;
			align-items: center;
		}

		#chooseLang {
			grid-column: 1/-1;
			justify-self: center;
			width: 100%;
		}

		.notShowJustForPreload {
			position: absolute;
			left: -100vw;
			top: -100vh;
			visibility: hidden;
			pointer-events: none;
			white-space: nowrap;
			user-select: none;
			height: 1px;
			overflow: hidden
		}

		#chooseMode {
			justify-self: start;

		}

		#chooseMode label {
			font-size: initial;
		}

		#chooseMode>div,
		#modeInfo>div {
			position: relative;
		}

		#modeInfo {
			justify-self: end;
			text-align: right;
		}

		.tooltip-text {
			display: none;
			position: absolute;
			z-index: 999;
			width: max-content;
			top: 105%;
			left: 2em;
			border: 1px solid black;
			background-color: FloralWhite;
			padding: 0.5px 0.5em;
			white-space: pre;
		}

		#inputCacheAge>.tooltip-text,
		#useRegex>.tooltip-text {
			right: 0;
			left: unset;
			top: 125%;
		}

		.tooltip-icon {
			background-color: transparent;
			border: 0;
			padding: 0;
			line-height: 1;
		}

		.tooltip-icon:hover+.tooltip-text,
		.tooltip-icon:focus+.tooltip-text,
		#cacheAge:hover+.tooltip-text,
		#cacheAge:focus+.tooltip-text {
			display: block;
		}

		#powerCalculatorContent {
			width: min(max(80%, 500px), 100%);
			margin: auto;
		}

		#pc_input {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 0.5em;
		}

		.inputBlock {
			border: 1px solid black;
			padding: 5px;
			display: flex;
			flex-direction: column;
		}

		.inputBlock input {
			width: 100%;
			box-sizing: border-box;
			margin-bottom: 0px;
			font-size: 0.75em;
			border: 0.5px dotted gray;
		}

		.hint {
			font-size: 0.7em;
			text-align: right;
		}

		#refine_wrapper {
			display: grid;
			grid-template-columns: 1fr auto;
		}

		#pc_control {
			width: 90%;
			text-align: center;
			margin: auto;
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 0.5em;
		}

		#button_maxStats {
			width: fit-content;
			justify-self: start;
		}

		#checkbox_infiniteMode {
			width: fit-content;
			justify-self: end;
		}

		#button_calcPower {
			grid-column: 1 / -1;
			font-size: 1em;
			border-radius: 5em;
			border: 1px solid black;
		}

		#pc_result_show {
			width: 75%;
			text-align: center;
			margin: auto;
			display: flex;
			flex-direction: column;
			gap: 0.5em;
		}

		#pc_result_show>label {
			display: grid;
			grid-template-columns: 40% 1fr;
		}

		#pc_result_show input[type="text"] {
			text-align: right;
			box-sizing: border-box;
			width: 100%;
		}

		#powerCalculatorContent hr {
			margin: 1em auto;
		}

		#checkbox_resultInvolvePassive {
			display: flex;
			justify-content: end;
			font-size: 0.75em;
			margin-top: 0.5rem;
			white-space: pre;
			text-align: right;
		}

		/*
		#prefWeapon2 {
			position: relative;
			opacity: 0.5;
		}

		#prefWeapon2::before {
			position: absolute;
			content: "&";
			left: -0.5em;
			transform: translateX(-100%);
		}
		*/

		#prefWeapon2 {
			filter: opacity(0.5);
		}

		#imageContent {
			display: grid;
			justify-items: center;
			gap: 0.5em;
		}

		#imageContent img {
			display: block;
			max-width: 100%;
			object-fit: contain;
		}
	</style>
</head>

<body>
	<div id="siteSetting">
		<div id="chooseLang">
			<select id="languagePick" onchange="setPickLang()">
				<option value="" disabled selected hidden>▼ Pick Info Language ▼</option>
				<option lang="en" value="English" data-shortname="EN">English (EN)</option>
				<option lang="ja" value="Japanese" data-shortname="JP">日本語 (JP)</option>
				<option lang="zh-Hant" value="ChineseTraditional" data-shortname="TC">繁體中文 (TC)</option>
				<option lang="zh-Hans" value="ChineseSimplified" data-shortname="SC">简体中文 (SC)</option>
				<option lang="fr" value="French" data-shortname="FR">Français (FR)</option>
				<option lang="de" value="German" data-shortname="DE">Deutsch (DE)</option>
				<option lang="it" value="Italian" data-shortname="IT">Italiano (IT)</option>
				<option lang="ko" value="Korean" data-shortname="KO">한국어 (KR)</option>
				<option lang="es" value="Spanish" data-shortname="ES">Español (ES)</option>
			</select>
			<div class="notShowJustForPreload">
				<span lang="en">English (EN)</span>
				<span lang="ja">日本語 (JP)</span>
				<span lang="zh-Hant">繁體中文 (TC)</span>
				<span lang="zh-Hans">简体中文 (SC)</span>
				<span lang="fr">Français (FR)</span>
				<span lang="de">Deutsch (DE)</span>
				<span lang="it">Italiano (IT)</span>
				<span lang="ko">한국어 (KR)</span>
				<span lang="es">Español (ES)</span>
			</div>
		</div>
		<div id="chooseMode" class="hidden">
			<div>
				<label>
					<input type="radio" name="dataMode" value="fastMode" onchange="selectDataMode()" checked />
					<span data-i18n="Setting_FastMode"></span>
				</label>
				<button class="tooltip-icon">ⓘ</button>
				<span class="tooltip-text" data-i18n="Setting_FastModeHint"></span>
			</div>
			<div>
				<label>
					<input type="radio" name="dataMode" value="rawMode" onchange="selectDataMode()" />
					<span data-i18n="Setting_RawMode"></span>
				</label>
				<button class="tooltip-icon">ⓘ</button>
				<span class="tooltip-text" data-i18n="Setting_RawModeHint"></span>
			</div>
		</div>
		<div id="modeInfo" class="hidden">
			<div id="showLastUpdateTime" class="hidden">
				<div data-i18n="Setting_LastUpdate"></div>
				<div id="lastUpdateTime"></div>
			</div>
			<div id="inputCacheAge" class="hidden">
				<div data-i18n="Setting_CacheAge"></div>
				<input id="cacheAge" type="number" min="0" value="60" style="width: 3.5em"
					onchange="changeCacheExpiryTime(this.value)" />
				<div class="tooltip-text" data-i18n="Setting_CacheAgeHint"></div>
			</div>
		</div>
	</div>
	<hr style="margin-top: 0.5em; margin-bottom: 5px" />

	<div id="dataProgress" class="hidden">
		<table>
			<colgroup>
				<col style="width:60%">
				<col style="width:40%">
			</colgroup>
			<tbody>
				<tr id="languageProgressRow">
					<td data-i18n="Progress_LanguageLabel"></td>
					<td id="languageProgress" data-i18n="Progress_Wait"></td>
				</tr>
				<tr id="monsterProgressRow">
					<td data-i18n="Progress_MonsterLabel"></td>
					<td id="monsterProgress" data-i18n="Progress_Wait"></td>
				</tr>
				<tr id="weaponProgressRow">
					<td data-i18n="Progress_WeaponLabel"></td>
					<td id="weaponProgress" data-i18n="Progress_Wait"></td>
				</tr>
				<tr id="equipmentProgressRow">
					<td data-i18n="Progress_EquipmentLabel"></td>
					<td id="equipmentProgress" data-i18n="Progress_Wait"></td>
				</tr>
			</tbody>
		</table>
	</div>

	<div class="hidden" id="filterArea">
		<div class="chooseOption" id="selectCategory">
			<label>
				<input type="radio" name="unit_category" value="Monster" onchange="changeCategory()" checked />
				<span data-i18n="Monster"></span>
			</label>
			<label>
				<input type="radio" name="unit_category" value="Weapon" onchange="changeCategory()" />
				<span data-i18n="Weapon"></span>
			</label>
			<label>
				<input type="radio" name="unit_category" value="Equipment" onchange="changeCategory()" />
				<span data-i18n="Equipment"></span>
			</label>
		</div>

		<div id="filterRarity">
			<button class="toggleAll" onclick="toggleAllCheckboxes(this)"></button>
			<div class="chooseOption">
				<label>
					<input type="checkbox" value="N" onchange="setSelectableList(this)" checked />
					<img src="icon/IconBrownRarityTextNNoIcon01.png">
				</label>
				<label>
					<input type="checkbox" value="R" onchange="setSelectableList(this)" checked />
					<img src="icon/IconWhiteRarityTextRNoIcon01.png">
				</label>
				<label>
					<input type="checkbox" value="SR" onchange="setSelectableList(this)" checked />
					<img src="icon/LargeSRText.png">
				</label>
				<label>
					<input type="checkbox" value="SSR" onchange="setSelectableList(this)" checked />
					<img src="icon/LargeSSRText.png">
				</label>
			</div>
		</div>

		<div id="filterStars">
			<button class="toggleAll" onclick="toggleAllCheckboxes(this)"></button>
			<div class="chooseOption" lang="en">
				<label><input type="checkbox" value="0" onchange="setSelectableList(this)" checked />
					0<img src="icon/IconPinkStar01_old.png">
				</label>
				<label><input type="checkbox" value="1" onchange="setSelectableList(this)" checked />
					1<img src="icon/IconPinkStar01_old.png">
				</label>
				<label><input type="checkbox" value="2" onchange="setSelectableList(this)" checked />
					2<img src="icon/IconPinkStar01_old.png">
				</label>
				<label><input type="checkbox" value="3" onchange="setSelectableList(this)" checked />
					3<img src="icon/IconPinkStar01_old.png">
				</label>
				<label><input type="checkbox" value="4" onchange="setSelectableList(this)" checked />
					4<img src="icon/IconPinkStar01_old.png">
				</label>
				<label><input type="checkbox" value="5" onchange="setSelectableList(this)" checked />
					5<img src="icon/IconPinkStar01_old.png">
				</label>
				<label><input type="checkbox" value="6" onchange="setSelectableList(this)" checked />
					6<img src="icon/IconPinkStar01_old.png">
				</label>
			</div>
		</div>

		<div id="filterElement" class="mo">
			<button class="toggleAll" onclick="toggleAllCheckboxes(this)"></button>
			<div class="chooseOption">
				<label>
					<input type="checkbox" value="Fire" onchange="setSelectableList(this)" checked />
					<img src="icon/Fire.png">
				</label>
				<label>
					<input type="checkbox" value="Water" onchange="setSelectableList(this)" checked />
					<img src="icon/Water.png">
				</label>
				<label><input type="checkbox" value="Earth" onchange="setSelectableList(this)" checked />
					<img src="icon/Earth.png">
				</label>
				<label>
					<input type="checkbox" value="Air" onchange="setSelectableList(this)" checked />
					<img src="icon/Air.png">
				</label>
				<label>
					<input type="checkbox" value="Life" onchange="setSelectableList(this)" checked />
					<img src="icon/Life.png">
				</label>
				<label>
					<input type="checkbox" value="Death" onchange="setSelectableList(this)" checked />
					<img src="icon/Death.png">
				</label>
			</div>
		</div>

		<div id="filterWeaponType" class="wo">
			<button class="toggleAll" onclick="toggleAllCheckboxes(this)"></button>
			<div class="chooseOption" id="filterWeaponTypeYellow">
				<label>
					<input type="checkbox" value="Sword" onchange="setSelectableList(this)" checked />
					<img src="icon/Sword.png">
				</label>
				<label>
					<input type="checkbox" value="Axe" onchange="setSelectableList(this)" checked />
					<img src="icon/Axe.png">
				</label>
				<label>
					<input type="checkbox" value="Staff" onchange="setSelectableList(this)" checked />
					<img src="icon/Staff.png"> </label>
				<label>
					<input type="checkbox" value="Mace" onchange="setSelectableList(this)" checked />
					<img src="icon/Mace.png"> </label>
			</div>

			<div class="chooseOption" id="filterWeaponTypeRed">
				<label>
					<input type="checkbox" value="GreatSword" onchange="setSelectableList(this)" checked />
					<img src="icon/GreatSword.png"> </label>
				<label>
					<input type="checkbox" value="GreatAxe" onchange="setSelectableList(this)" checked />
					<img src="icon/GreatAxe.png"> </label>
				<label>
					<input type="checkbox" value="Spear" onchange="setSelectableList(this)" checked />
					<img src="icon/Spear.png"> </label>
				<label>
					<input type="checkbox" value="Hammer" onchange="setSelectableList(this)" checked />
					<img src="icon/Hammer.png"> </label>
				<label>
					<input type="checkbox" value="Katana" onchange="setSelectableList(this)" checked />
					<img src="icon/Katana.png"> </label>
			</div>
		</div>

		<div id="filterText">
			<div id="filterTextInputZone">
				<button id="openFilterTextOption" onclick="switchFilterTextOption()">☰</button>
				<input id="filterTextInput" type="text" data-i18n-placeholder="HintFilterName" placeholder="⌕"
					oninput="setSelectableList()" />
				<label id="useRegex">
					<input type="checkbox" name="regexMode" value="regex" onchange="setSelectableList(this)" />
					<svg class="tooltip-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" height="1rem"
						width="1rem" fill="currentColor">
						<path
							d="M 333.939 -179.27 C 315.833 -179.27 300.414 -185.64 287.679 -198.39 C 274.934 -211.12 268.563 -226.54 268.563 -244.65 C 268.563 -262.75 274.934 -278.17 287.679 -290.91 C 300.414 -303.65 315.833 -310.02 333.939 -310.02 C 352.044 -310.02 367.463 -303.65 380.199 -290.91 C 392.943 -278.17 399.314 -262.75 399.314 -244.65 C 399.314 -226.54 392.943 -211.12 380.199 -198.39 C 367.463 -185.64 352.044 -179.27 333.939 -179.27 Z M 519.606 -430.31 L 519.606 -547.59 L 418.221 -488.96 L 384.226 -546.88 L 485.611 -605.52 L 384.226 -664.16 L 418.221 -722.09 L 519.606 -663.46 L 519.606 -780.73 L 587.597 -780.73 L 587.597 -663.46 L 688.982 -722.09 L 722.977 -664.16 L 621.592 -605.52 L 722.977 -546.88 L 688.982 -488.96 L 587.597 -547.59 L 587.597 -430.31 L 519.606 -430.31 Z" />
					</svg>
					<div class="tooltip-text">/Regex/i</div>
				</label>
			</div>

			<div id="filterTextOption" class="hidden">
				<button class="mo wo eo textFilterOptionLabel" data-i18n="FilterText_LabelName"
					onclick="toggleAllCheckboxes(this)"></button>
				<div class="mo wo eo textFilterOptionGroup">
					<label>
						<input type="checkbox" name="textFilterField" value="Name" onchange="setSelectableList(this)"
							checked />
						<span data-i18n="FilterText_OptionName"></span>
					</label>
					<label class="mo">
						<input type="checkbox" name="textFilterField" value="Name2" onchange="setSelectableList(this)"
							checked />
						<span data-i18n="FilterText_OptionName2"></span>
					</label>
					<label>
						<input type="checkbox" name="textFilterField" value="Codename"
							onchange="setSelectableList(this)" checked />
						<span data-i18n="FilterText_OptionCodename"></span>
					</label>
				</div>
				<button class="mo wo eo textFilterOptionLabel" data-i18n="Profile"
					onclick="toggleAllCheckboxes(this)"></button>
				<div class="mo wo eo textFilterOptionGroup">
					<label>
						<input type="checkbox" name="textFilterField" value="Profile"
							onchange="setSelectableList(this)" />
						<span data-i18n="Profile"></span>
					</label>
				</div>
				<button class="mo wo textFilterOptionLabel" data-i18n="GachaIntro"
					onclick="toggleAllCheckboxes(this)"></button>
				<div class="mo wo textFilterOptionGroup">
					<label>
						<input type="checkbox" name="textFilterField" value="GachaIntro"
							onchange="setSelectableList(this)" />
						<span data-i18n="GachaIntro"></span>
					</label>
				</div>
				<button class="mo textFilterOptionLabel" data-i18n="LeaderSkill"
					onclick="toggleAllCheckboxes(this)"></button>
				<div class="mo textFilterOptionGroup">
					<label>
						<input type="checkbox" name="textFilterField" value="LeaderSkillTitle"
							onchange="setSelectableList(this)" />
						<span data-i18n="FilterText_OptionSkillName"></span>
					</label>
					<label>
						<input type="checkbox" name="textFilterField" value="LeaderSkillDescription"
							onchange="setSelectableList(this)" />
						<span data-i18n="FilterText_OptionSkillDescription"></span>
					</label>
				</div>
				<button class="mo textFilterOptionLabel" data-i18n="ActiveSkill"
					onclick="toggleAllCheckboxes(this)"></button>
				<div class="mo textFilterOptionGroup">
					<label>
						<input type="checkbox" name="textFilterField" value="ActiveSkillTitle"
							onchange="setSelectableList(this)" />
						<span data-i18n="FilterText_OptionSkillName"></span>
					</label>
					<label>
						<input type="checkbox" name="textFilterField" value="ActiveSkillDescription"
							onchange="setSelectableList(this)" />
						<span data-i18n="FilterText_OptionSkillDescription"></span>
					</label>
				</div>
				<button class="mo textFilterOptionLabel" data-i18n="PassiveSkill"
					onclick="toggleAllCheckboxes(this)"></button>
				<div class="mo textFilterOptionGroup">
					<label>
						<input type="checkbox" name="textFilterField" value="PassiveSkillTitle"
							onchange="setSelectableList(this)" />
						<span data-i18n="FilterText_OptionSkillName"></span>
					</label>
					<label>
						<input type="checkbox" name="textFilterField" value="PassiveSkillDescription"
							onchange="setSelectableList(this)" />
						<span data-i18n="FilterText_OptionSkillDescription"></span>
					</label>
				</div>
				<button class="wo textFilterOptionLabel" data-i18n="WeaponSkill"
					onclick="toggleAllCheckboxes(this)"></button>
				<div class="wo textFilterOptionGroup">
					<label>
						<input type="checkbox" name="textFilterField" value="WeaponSkillTitle"
							onchange="setSelectableList(this)" />
						<span data-i18n="FilterText_OptionSkillName"></span>
					</label>
					<label>
						<input type="checkbox" name="textFilterField" value="WeaponSkilleDescription"
							onchange="setSelectableList(this)" />
						<span data-i18n="FilterText_OptionSkillDescription"></span>
					</label>
				</div>



			</div>
		</div>

		<div id="selectableList">
			<select id="targetSelect" onchange="displayData()">
				<option data-i18n="HintSelectTarget" value="" disabled selected hidden></option>
			</select>
			<label>
				<input type="checkbox" id="reverseToggle" onchange="reverseOptions()" value="false" />
				<span data-i18n="Reverse"></span>
			</label>
		</div>
		<hr style="margin: 1em -0.5em auto" />
	</div>
	<div id="mainBlock">
		<div id="nameDisplay">
			<div id="codeName"></div>
			<div id="subName"></div>
			<div id="bigName"></div>
		</div>

		<div id="viewContent">
			<div class="hidden" id="generalStatsArea">
				<div id="headshotZone" class="hidden">
					<div class="headshotBox" id="headshot_General">
						<img src="">
					</div>
					<div class="headshotBox" id="headshot_Cosmo" class="hidden">
						<img src="">
					</div>
				</div>
				<div class="infoRow hidden" id="rarity">
					<div class="infoTitle" data-i18n="Rarity"></div>
					<div class="infoValue"><img src=""></div>
				</div>
				<div class="infoRow hidden" id="stars">
					<div class="infoTitle" data-i18n="Stars"></div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="preferredWeapon">
					<div class="infoTitle" data-i18n="PreferredWeapon"></div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="weaponType">
					<div class="infoTitle" data-i18n="WeaponType"></div>
					<div class="infoValue"><img src=""></div>
				</div>
				<div class="infoRow hidden" id="element">
					<div class="infoTitle" data-i18n="Element"></div>
					<div class="infoValue"><img src=""></div>
				</div>
				<div class="infoRow hidden" id="cost">
					<div class="infoTitle" data-i18n="Cost">
					</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="atk">
					<div class="infoTitle" data-i18n="Atk"></div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="hp">
					<div class="infoTitle" data-i18n="Hp"></div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="speed">
					<div class="infoTitle" data-i18n="Speed"></div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="power">
					<div class="infoTitle">
						<div data-i18n="Power"></div>
						<div id="powerHint" style="text-align: center; text-align-last: center; font-size: 0.7em"
							data-i18n="Hint_Power"></div>
					</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="freeEvo">
					<div class="infoTitle" data-i18n="FreeEvo"></div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="visible">
					<div class="infoTitle" data-i18n="Visible"></div>
					<div class="infoValue"></div>
				</div>
			</div>

			<div class="hidden" id="gachaIntroArea">
				<hr />
				<div class="areaTitle" id="profileTitle" data-i18n="GachaIntro"></div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="gachaIntroContent">
						<div id="gachaIntroText" style="text-align: center"></div>
					</div>
				</div>
			</div>

			<div class="hidden" id="profileArea">
				<hr />
				<div class="areaTitle" id="profileTitle" data-i18n="Profile"></div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="profileContent">
						<div id="profileText"></div>
					</div>
				</div>
			</div>

			<div class="hidden" id="leaderSkillArea">
				<hr />
				<div class="areaTitle" id="leaderSkillTitle" data-i18n="LeaderSkill"></div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="leaderSkillContent">
						<div id="leaderSkillName"></div>
						<div id="leaderSkillDecription"></div>
					</div>
				</div>
			</div>

			<div class="hidden" id="weaponSkillArea">
				<hr />
				<div class="areaTitle" id="weaponSkillTitle" data-i18n="WeaponSkill"></div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="weaponSkillContent">
						<div id="weaponSkillName"></div>
						<div id="weaponSkillDecription"></div>
					</div>
				</div>
			</div>

			<div class="hidden" id="activeSkillArea">
				<hr />
				<div class="areaTitle" id="activeSkillTitle" data-i18n="ActiveSkill"></div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="activeSkillContent"></div>
				</div>
			</div>

			<div class="hidden" id="passiveSkillArea">
				<hr />
				<div class="areaTitle" id="passiveSkillTitle" data-i18n="PassiveSkill"></div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="passiveSkillContent"></div>
				</div>
			</div>

			<div class="hidden" id="summonableMonstersArea">
				<hr />
				<div class="areaTitle" id="summonableMonstersTitle" data-i18n="Summonable"></div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="summonableMonstersContent"></div>
				</div>
			</div>

			<div class="hidden" id="dialogArea">
				<hr />
				<div class="areaTitle" id="dialogTitle" data-i18n="Dialog"></div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="dialogContent"></div>
				</div>
			</div>

			<div class="hidden" id="aiLogicArea">
				<hr />
				<div class="areaTitle" id="aiLogicTitle" data-i18n="AiLogic"></div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="aiLogicContent"></div>
				</div>
			</div>

			<div class="hidden" id="relationshipArea">
				<hr />
				<div class="areaTitle" id="relationshipTitle" data-i18n="Ralationship"></div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="relationshipContent"></div>
				</div>
			</div>

			<div class="hidden" id="powerCalculatorArea">
				<hr />
				<div class="areaTitle" id="powerCalculatorTitle" data-i18n="PowerCalculator"></div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="powerCalculatorContent">
						<div id="pc_input">
							<div class="inputBlock" id="pc_baseAtkInput">
								<label for="input_atkBase" id="baseAtkLabel" data-i18n="Atk_Base"></label>
								<input type="number" id="input_atkBase" value="0" min="0" step="1" />
								<div class="hint" id="hint_atkBase">0~</div>
							</div>
							<div class="inputBlock" id="pc_baseHpInput">
								<label for="input_hpBase" id="baseHpLabel" data-i18n="Hp_Base"></label>
								<input type="number" id="input_hpBase" value="0" min="0" step="1" />
								<div class="hint" id="hint_hpBase">0~</div>
							</div>
							<div class="inputBlock" id="pc_starsCurrentInput">
								<label for="input_starsCurrent" id="starsCurrentLabel"
									data-i18n="Stars_Current"></label>
								<input type="number" id="input_starsCurrent" value="0" min="0" max="6" step="1" />
								<div class="hint" id="hint_starsCurrent">0~6</div>
							</div>
							<div class="inputBlock" id="pc_starsMaxInput">
								<label for="input_starsMax" id="starsMaxLabel" data-i18n="Stars_Max"></label>
								<input type="number" id="input_starsMax" value="0" min="0" max="6" step="1" />
								<div class="hint" id="hint_starsMax">0~6</div>
							</div>
							<div class="inputBlock" id="pc_limitBreakInput">
								<label for="input_limitBreak" id="limitBreakLabel" data-i18n="ExtraEvolution"></label>
								<input type="number" id="input_limitBreak" value="0" min="0" max="5" step="1" />
								<div class="hint" id="hint_limitBreak">0~5</div>
							</div>
							<div class="inputBlock" id="pc_levelInput">
								<label for="input_level" id="levelLabel" data-i18n="Level"></label>
								<input type="number" id="input_level" value="1" min="1" max="200" step="1" />
								<div class="hint" id="hint_level">1~200</div>
							</div>
							<div class="inputBlock" id="pc_awakeningInput">
								<label for="input_awakening" id="awakeningLabel" data-i18n="Awaken"></label>
								<input type="number" id="input_awakening" value="0" min="0" max="4" step="1" />
								<div class="hint" id="hint_awakening">0~4</div>
							</div>
							<div class="inputBlock" id="pc_cosmoInput">
								<label for="input_cosmo" id="cosmoLabel" data-i18n="CosmoAwaken"></label>
								<input type="checkbox" id="input_cosmo" />
							</div>
							<div class="inputBlock" id="pc_boostInput">
								<label for="input_boost" id="boostLabel" data-i18n="Boost"></label>
								<input type="number" id="input_boost" value="0" min="0" max="300" step="1" />
								<div class="hint" id="hint_boost">0~300</div>
							</div>
							<div class="inputBlock" id="pc_refineInput">
								<label for="input_refine" id="refineLabel" data-i18n="Refine"></label>
								<div id="refine_wrapper">
									<input type="number" id="input_refine" value="0.00" min="0.00" max="100.00"
										step="0.01" />
									<span style="font-size: 0.75em;">%</span>
								</div>
								<div class="hint" id="hint_refine">0.00~100.00</div>
							</div>
							<div class="inputBlock" id="pc_masteryInput">
								<label for="input_mastery" id="masteryLabel" data-i18n="Mastery"></label>
								<input type="number" id="input_mastery" value="0" min="0" max="40" step="1" />
								<div class="hint" id="hint_mastery">0~40</div>
							</div>
						</div>
						<hr />
						<div id="pc_control">
							<button id="button_maxStats" data-i18n="MaxStats"></button>
							<label id="checkbox_infiniteMode">
								<input type="checkbox" id="infiniteMode" value="false" />
								<span data-i18n="InfiniteMode"></span>
							</label>
							<button id="button_calcPower" data-i18n="CalculatePower"></button>
						</div>
						<hr />

						<div id="pc_result">
							<div id="pc_result_show">
								<label>
									<span data-i18n="Atk"></span>
									<input type="text" id="result_atk" readonly />
								</label>
								<label>
									<span data-i18n="Hp"></span>
									<input type="text" id="result_hp" readonly />
								</label>
								<label>
									<span data-i18n="Power"></span>
									<input type="text" id="result_power" readonly />
								</label>
							</div>
							<label id="checkbox_resultInvolvePassive">
								<input type="checkbox" id="resultInvolvePassive" checked />
								<span data-i18n="ResultInvolvePassive"></span>
							</label>
						</div>
					</div>
				</div>
			</div>

			<div class="hidden" id="imageArea">
				<hr />
				<div class="areaTitle" id="imageTitle" data-i18n="Image"></div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="imageContent">
					</div>
				</div>
			</div>
		</div>
	</div>

	<template id="template-hasAscended">
		<div id="hasAscended">
			<div id="profileAscendedTitle" data-i18n="AscendedPart"></div>
			<div id="profileAscendedText"></div>
		</div>
	</template>

	<template id="template-activeSkill">
		<div class="activeSkillDetail">
			<div class="activeSkillName"></div>
			<div class="activeSkillSpirit" lang="en"><img src="icon/IconPurpleSpiritLarge01.png">spirit</div>
			<div class="activeSkillTU" lang="en"><img src="icon/IconGreenClock01.png">TU</div>
			<div class="activeSkillDecription"></div>
		</div>
	</template>

	<template id="template-passiveSkill">
		<div class="passiveSkillDetail">
			<div class="passiveSkillName"></div>
			<div></div>
			<div></div>
			<div class="passiveSkillDecription"></div>
		</div>
	</template>

	<template id="template-dialog">
		<div class="dialogGroup">
			<div class="dialogGroupTitle"></div>
			<div class="dialogText"></div>
		</div>
	</template>

	<template id="template-relationship">
		<div class="relationshipAGroup">
			<div class="relationshipName"></div>
			<div class="relationshipBonus"></div>
			<div class="relationshipMembers"></div>
		</div>
	</template>

	<script>
		/*=====語言顯示設定區塊=====*/

		let specifiedLang = null;
		const fallbackLang = "English";
		let siteLangData = null;
		const cacheKey_Lang = "cacheLastLang";
		const reversedLangList = {};

		document.addEventListener("DOMContentLoaded", initLang);

		async function initLang() {
			siteLangData = await fetchCheck("SiteLocalization.json").then((res) => res.json());

			const lang = new URLSearchParams(window.location.search).get("lang");
			if (lang) {
				const languagePick = document.getElementById("languagePick");
				for (let option of languagePick.options) {
					if (option.value === lang || option.dataset.shortname === lang) {
						document.getElementById("languagePick").value = option.value;
						setPickLang();
						return;
					}
				}
			}

			const cache_LastLang = localStorage.getItem(cacheKey_Lang);
			const languagePick = document.getElementById("languagePick");
			if (cache_LastLang && Array.from(languagePick.options).some(opt => opt.value === cache_LastLang)) {
				languagePick.value = cache_LastLang;
				setPickLang();
			}
		}

		async function setPickLang() {
			document.getElementById("languagePick").disabled = true;
			specifiedLang = document.getElementById("languagePick").value;

			document.documentElement.lang = getLocalizationText("LangCode");
			for (const el of document.querySelectorAll("[data-i18n]")) {
				const textKey = el.getAttribute("data-i18n");
				el.textContent = getLocalizationText(textKey);
			}
			for (const el of document.querySelectorAll("[data-i18n-placeholder]")) {
				const textKey = el.getAttribute("data-i18n-placeholder");
				el.placeholder = getLocalizationText(textKey);
			}

			initTitle = document.title;
			document.getElementById("chooseMode").classList.remove("hidden");
			document.getElementById("modeInfo").classList.remove("hidden");
			document.getElementById("filterArea").classList.add("hidden");
			document.getElementById("mainBlock").classList.add("hidden");
			initSelectOptionContent = document.getElementById("targetSelect").options[0].outerHTML;
			localStorage.setItem(cacheKey_Lang, specifiedLang);
			await selectDataMode();
			if ((currentDisplayID, currentDisplayCategory)) displayData(currentDisplayID, currentDisplayCategory);
			document.getElementById("languagePick").disabled = false;
		}

		function getCodeByShowedName(queryName) {
			return siteLangData[specifiedLang]["ReversedList"][queryName];
		}

		function getLocalizationText(textKey) {
			return siteLangData[specifiedLang][textKey] || siteLangData[fallbackLang][textKey] || "";
		}
	</script>

	<script>
		let unit_category = document.querySelector('input[name="unit_category"]:checked').value;
		let wholeData = {};

		async function selectDataMode() {
			const dataMode = document.querySelector('input[name="dataMode"]:checked').value
			if (dataMode === "rawMode") {
				document.getElementById("showLastUpdateTime").classList.add("hidden");
				document.getElementById("inputCacheAge").classList.remove("hidden");
				if (localStorage.getItem("cacheAge")) document.getElementById("cacheAge").value = localStorage.getItem("cacheAge");
			} else {
				document.getElementById("inputCacheAge").classList.add("hidden");
				document.getElementById("showLastUpdateTime").classList.remove("hidden");
				const lastUpdateTimestamp = await (await fetchCheck("lastUpdate")).text();
				document.getElementById("lastUpdateTime").textContent = new Date(lastUpdateTimestamp * 1000).toLocaleString(undefined, {
					hour12: false,
					year: "numeric",
					month: "2-digit",
					day: "2-digit",
					hour: "2-digit",
					minute: "2-digit",
					timeZoneName: "short"
				});
			}
			await initPage();
		}

		async function initPage() {
			await initFilter();
			await loadWholeData();
			await setSelectableList();
			await analyzeUrlParams();
		}

		async function changeCacheExpiryTime(cacheAge) {
			if (cacheAge <= 0) {
				localStorage.setItem("cacheExpiryTimestamp", 0);
				if (localStorage.getItem("cacheAge")) document.getElementById("cacheAge").value = localStorage.getItem("cacheAge");
				await initPage();
			} else {
				const cacheDuration = cacheAge * 60 * 1000;
				localStorage.setItem("cacheExpiryTimestamp", (cacheDuration + Date.now()).toString());
				localStorage.setItem("cacheAge", cacheAge);
			}
		}
	</script>

	<script>
		/*=====篩選邏輯區塊=====*/

		let initSelectOptionContent = document.getElementById("targetSelect").options[0].outerHTML;

		function initFilter() {
			if (!currentDisplayCategory)
				document.getElementById("selectCategory").querySelector('input[type="radio"]').checked = true;
			document.querySelectorAll('#filterArea input[type="checkbox"][checked]').forEach((c) => (c.checked = true));
			document.querySelectorAll('#filterArea input[type="checkbox"]:not([checked])').forEach((c) => (c.checked = false));
			changeCategory();
			document.getElementById("reverseToggle").checked = false;
			document.getElementById("filterTextInput").value = "";
			document.getElementById("filterTextOption").classList.add("hidden");
			document.querySelector("#useRegex input").checked = false;
		}

		function changeCategory() {
			unit_category = document.querySelector('input[name="unit_category"]:checked').value;

			document.querySelectorAll(".mo, .wo, .eo").forEach(function (el) {
				el.classList.add("hidden");
			});

			switch (unit_category) {
				case "Equipment":
					document.querySelectorAll(".eo").forEach(function (el) { el.classList.remove("hidden"); });
					break;
				case "Weapon":
					document.querySelectorAll(".wo").forEach(function (el) { el.classList.remove("hidden"); });
					break;
				default:
					document.querySelectorAll(".mo").forEach(function (el) { el.classList.remove("hidden"); });
					break;

			}

			document.querySelectorAll('.chooseOption input[type="checkbox"][checked]').forEach((el) => (el.checked = true));
			document.querySelectorAll('.chooseOption input[type="checkbox"]:not([checked])').forEach((el) => (el.checked = false));
			document.getElementById("reverseToggle").checked = false;
			document.getElementById("filterTextInput").value = "";

			setSelectableList();
		}

		function setSelectableList(triggerElement) {
			const targetSelect = document.getElementById("targetSelect");
			targetSelect.innerHTML = initSelectOptionContent;

			const selectedRarities = Array.from(document.querySelectorAll("#filterRarity input:checked")).map(
				(cb) => cb.value
			);
			const selectedStars = Array.from(document.querySelectorAll("#filterStars input:checked")).map((cb) => cb.value);
			const selectedElements = Array.from(document.querySelectorAll("#filterElement input:checked")).map(
				(cb) => cb.value
			);
			const selectedWeaponTypes = Array.from(document.querySelectorAll("#filterWeaponType input:checked")).map(
				(cb) => cb.value
			);

			const filteredStars = new Set();
			const filterText = document.getElementById("filterTextInput").value.trim();
			const filterWithRegex = document.querySelector("#useRegex input").checked;

			for (const id in wholeData[unit_category]) {
				const entry = wholeData[unit_category][id];
				const option = document.createElement("option");

				if (!selectedRarities.includes(entry["Rarity"])) continue;
				if (unit_category === "Monster" && !selectedElements.includes(entry["forFilter_Element"])) continue;
				if (unit_category === "Weapon" && !selectedWeaponTypes.includes(entry["forFilter_WeaponType"])) continue;

				filteredStars.add(entry["Stars_Curr"]);
				if (!selectedStars.includes(String(entry["Stars_Curr"]))) continue;

				if (filterText !== "" && !filterByText(filterText, id, entry, filterWithRegex)) continue;

				option.value = id;
				option.text = getFullNameAddStarsOrRarity(id, unit_category, true, false);
				targetSelect.appendChild(option);
			}

			if (document.getElementById("reverseToggle").checked) reverseOptions();
			targetSelect.selectedIndex = 0;

			if (filteredStars.size !== 0) {
				//禁用沒有的星數選項
				Array.from(document.querySelectorAll("#filterStars input")).forEach((cb) => {
					cb.disabled = false;
					if (!filteredStars.has(Number(cb.value))) {
						cb.checked = false;
						cb.disabled = true;
					}
				});

				//若非星數區塊觸發，且星數都未選，則全選
				const selectedStarsNew = Array.from(document.querySelectorAll("#filterStars input:checked")).map(
					(cb) => cb.value
				);
				if (triggerElement && !triggerElement.closest("#filterStars") && selectedStarsNew.length === 0) {
					document.querySelectorAll("#filterStars input").forEach((cb) => (cb.checked = true));
					setSelectableList();
				}
			}
		}

		function filterByText(filterText, id, entry, filterWithRegex = false) {
			let matchTarget = filterText;
			if (filterWithRegex) {
				try {
					matchTarget = new RegExp(filterText, 'i');
				} catch (e) {
					return false;
				}
			}

			const checkedField = Array.from(document.querySelectorAll("#filterTextOption input:checked")).map((cb) => cb.value);

			if (checkedField.includes("Codename")) {
				if (matchTest(id, matchTarget, filterWithRegex)) return true;
			}
			if (checkedField.includes("Name")) {
				if (matchTest((entry?.["Name"] ?? ""), matchTarget, filterWithRegex)) return true;
			}
			if (checkedField.includes("Name2")) {
				if (matchTest((entry?.["Name2"] ?? ""), matchTarget, filterWithRegex)) return true;
			}
			if (checkedField.includes("Profile")) {
				if (matchTest((entry?.["Profile"] ?? ""), matchTarget, filterWithRegex) ||
					matchTest((entry?.["Profile_Ascended"] ?? ""), matchTarget, filterWithRegex))
					return true;
			}
			if (checkedField.includes("GachaIntro")) {
				if (matchTest((entry?.["GachaIntro"] ?? ""), matchTarget, filterWithRegex))
					return true;
			}
			if (checkedField.includes("LeaderSkillTitle")) {
				if (matchTest((entry?.["LeaderSkill"]?.["SkillTitle"] ?? ""), matchTarget, filterWithRegex)) return true;
			}
			if (checkedField.includes("LeaderSkillDescription")) {
				if (matchTest((entry?.["LeaderSkill"]?.["SkillDescription"] ?? ""), matchTarget, filterWithRegex)) return true;
			}
			if (checkedField.includes("ActiveSkillTitle") || checkedField.includes("ActiveSkillDescription")) {
				for (const skill of entry?.["ActiveSkill"] ?? []) {
					if (checkedField.includes("ActiveSkillTitle") && matchTest((skill?.["SkillTitle"] ?? ""), matchTarget, filterWithRegex)) return true;
					if (checkedField.includes("ActiveSkillDescription") && matchTest((skill?.["SkillDescription"] ?? ""), matchTarget, filterWithRegex)) return true;
				}
			}
			if (checkedField.includes("PassiveSkillTitle") || checkedField.includes("PassiveSkillDescription")) {
				for (const skill of entry?.["PassiveSkill"] ?? []) {
					if (checkedField.includes("PassiveSkillTitle") && matchTest((skill?.["SkillTitle"] ?? ""), matchTarget, filterWithRegex)) return true;
					if (checkedField.includes("PassiveSkillDescription") && matchTest((skill?.["SkillDescription"] ?? ""), matchTarget, filterWithRegex)) return true;
				}
			}
			if (checkedField.includes("WeaponSkillTitle") || checkedField.includes("WeaponSkilleDescription")) {
				for (const skill of entry?.["WeaponSkill"] ?? []) {
					if (checkedField.includes("WeaponSkillTitle") && matchTest((skill?.["SkillTitle"] ?? ""), matchTarget, filterWithRegex)) return true;
					if (checkedField.includes("WeaponSkilleDescription") && matchTest((skill?.["SkillDescription"] ?? ""), matchTarget, filterWithRegex)) return true;
				}
			}

			return false;
		}

		function matchTest(sourceText, matchTarget, filterWithRegex) {
			if (filterWithRegex) {
				return matchTarget.test(sourceText);
			} else {
				return sourceText.toLowerCase().includes(matchTarget.toLowerCase());
			}
			return false;
		}

		function switchFilterTextOption() {
			document.getElementById("filterTextOption").classList.toggle("hidden");
		}

		function reverseOptions() {
			const selectableTarget = document.getElementById("targetSelect");
			const originalOptions = Array.from(selectableTarget.options).slice(1);
			const newOptions = originalOptions.reverse();
			selectableTarget.innerHTML = initSelectOptionContent;
			newOptions.forEach((option) => selectableTarget.appendChild(option));
			selectableTarget.selectedIndex = 0;
		}

		function toggleAllCheckboxes(toggleElement) {
			const toggleContainer = toggleElement.classList.contains("textFilterOptionLabel") ? toggleElement.nextElementSibling : toggleElement.parentElement
			const checkboxes = toggleContainer.querySelectorAll('input[type="checkbox"]');

			// 檢查目前是否全選
			const allChecked = Array.from(checkboxes)
				.filter((cb) => !cb.disabled)
				.every((cb) => cb.checked);
			checkboxes.forEach((cb) => (cb.checked = !allChecked));

			setSelectableList();
		}
	</script>

	<script>
		/*=====載入資料區塊=====*/

		let langData = {};
		let weaponType = {};
		let elementType = {};
		let passiveBonus = {};
		const corsProxies = [
			"https://corsproxy.io/?",
			"https://cors-proxy.evertale.qzz.io/?"
		];
		const resourceUrlPrefix = "https://prd.evertaleserver.com/Prd280/";

		async function fetchCheck(url) {
			const response = await fetch(url);
			if (!response.ok) {
				//const comtentText = await response.text();
				//alert(`HTTP Error ${response.status}: ${response.statusText}\n${comtentText}`);
				throw new Error(`HTTP ${response.status}`);
			}
			return response;
		}

		async function fetchCheckWithProxy(url) {
			for (const proxy of corsProxies) {
				try {
					const response = await fetch(`${proxy}${url}`);
					if (!response.ok) {
						throw new Error(`HTTP ${response.status}`);
					}
					return response;
				} catch (error) {
					console.error(`CORS proxy ${proxy} failed`, error);
				}
			}
			throw new Error("All CORS proxies failed");
		}


		async function loadWholeData() {
			const dataMode = document.querySelector('input[name="dataMode"]:checked').value
			if (dataMode === "rawMode") {
				document.getElementById("siteSetting").querySelectorAll("input, select").forEach(e => { e.disabled = true; });
				document.getElementById("filterArea").classList.add("hidden");
				document.getElementById("mainBlock").classList.add("hidden");
				document.getElementById("dataProgress").classList.remove("hidden");
				document.querySelectorAll("#languageProgress,#monsterProgress,#weaponProgress,#equipmentProgress").forEach((e) => (e.textContent = getLocalizationText("Progress_Wait")));

				const cacheKey_Data = "cacheWholeData";
				const cacheKey_Time = "cacheExpiryTimestamp";
				const cacheKey_DataLang = "cacheDataLang";
				const cacheDuration = document.getElementById("cacheAge").value * 60 * 1000;

				const cache_WholeData = localStorage.getItem(cacheKey_Data);
				const cache_Time = localStorage.getItem(cacheKey_Time);
				const cache_DataLang = localStorage.getItem(cacheKey_DataLang);
				if ((cache_DataLang === specifiedLang) && cache_WholeData && cache_Time && Date.now() < cache_Time) {
					wholeData = JSON.parse(cache_WholeData);
				} else {
					await loadLanguageText();
					await Promise.all([buildMonsterData(), buildWeaponData(), buildEquipmentData()]);
					try {
						localStorage.setItem(cacheKey_Data, JSON.stringify(wholeData));
						localStorage.setItem(cacheKey_Time, (cacheDuration + Date.now()).toString());
						localStorage.setItem(cacheKey_DataLang, specifiedLang);
					} catch (e) {
						console.log(e);
					}
				}

				//console.log(wholeData);
				document.getElementById("dataProgress").classList.add("hidden");
				document.getElementById("siteSetting").querySelectorAll("input, select").forEach(e => { e.disabled = false; });
			} else {
				const dataUrls = {
					Monster: `Collection/${specifiedLang}/Monster.json`,
					Weapon: `Collection/${specifiedLang}/Weapon.json`,
					Equipment: `Collection/${specifiedLang}/Accessory.json`,
				};
				for (const [key, url] of Object.entries(dataUrls)) {
					try {
						const rawText = await fetchCheck(url).then((res) => res.text());
						const jsonData = JSON.parse(rawText.replace(/\\(?![\\\/bfnrtu"])/g, "\\\\"));
						wholeData[key] = jsonData;
					} catch (e) {
						console.error(`Read or parse ${key} error:`, e);
					}
				}
			}
			document.getElementById("filterArea").classList.remove("hidden");
		}

		async function loadLanguageText() {
			langData = {};

			const langLink = {};
			new Set([specifiedLang, fallbackLang]).forEach((lang) => {
				langLink[lang] = `${resourceUrlPrefix}Localization/Localizable_${lang}.txt`;
			});

			document.getElementById("languageProgress").textContent = getLocalizationText("Progress_Loading");
			console.time("Lang");
			try {
				for (const [langKey, filelink] of Object.entries(langLink)) {
					let singleLangData = {};
					const responseText = await (await fetchCheckWithProxy(filelink)).text();
					const lines = responseText.split(/\r?\n/);

					/*原方法。廢棄
					for (let line of lines) {
						const match = line.match(/"(.*)"="(.*)"/);
						if (match) {
							const [, key, value] = match;
							singleLangData[key] = value;
						}
					}
					*/

					/*//研究實際解析方式，依驗證結果，嘗試復現。但不直接採用
					//另外，不確定是在解析或顯示的步驟，處理跳脫字元時，單獨無效的\會被消除
					const regex = /(?<!\\)"(.*?)(?<!\\)".*?=.*?(?<!\\)"(.*?)(?:(?<!\\)"|$)/;
					for (let line of lines) {
						const match = line.match(regex);
						if (match) {
							const [, key, value] = match;
							singleLangData[key] = value;
						}
					}
					*/

					/*//測試方法1。全正則一次搞定，現版本可行，但對預想的某些可能錯誤恐無法完全解決。找更穩妥方法
					const regex = /^"((?:\\.|[^"])*)"\s*=\s*"((?:\\.|.)*?)(?:(?<![\\])")+[^"]*\s*$/gms;
					singleLangData = Object.fromEntries(
						Array.from(responseText.matchAll(regex), m => [m[1], m[2]])
					);
					*/

					/*//測試方法2。拆行讀取，現版本幾乎可行，但對預想的某些可能錯誤恐無法完全解決
					const regex = /^"((?:\\.|[^"\\])*)"\s*=\s*"(.*)$/;
					const regex_endCheck = /[^\\]"[;,]?\s*$/;
					let currentKey = null;
					let buffer = [];
	
					for (const line of lines) {
						if (currentKey === null) {
							// 嘗試匹配新的 key=value
							const match = line.match(regex);
							if (match) {
								currentKey = match[1];
								buffer.push(match[2]);
							}
						} else {
							// 還在收集跨行 value
							buffer.push(line);
						}
						// 如果這行就已經結尾，直接收尾
						if (currentKey !== null && regex_endCheck.test(line)) {
							let raw = buffer.join("\n");
							raw = raw.replace(/(?<!\\)"+[,;]?\s*$/, ""); // 去掉最後一個 " 或 ; , 
							singleLangData[currentKey] = raw;
							currentKey = null;
							buffer = [];
						}
					}
					*/

					//方法2改良。拆行讀取，不判斷結尾，改以若出現新key則收尾
					const regex = /^"((?:\\.|[^"])*)".*?=.*?"(.*)$/;
					let currentKey = null;
					let valueCollection = [];

					for (const line of lines) {
						const match = line.match(regex);
						//匹配，紀錄key，逐行收集val。若新行有新key則收尾，現key-value存入
						if (match) {
							if (currentKey !== null) {
								let wholeValue = valueCollection.join("\n"); //拼接value，可能多行
								wholeValue = wholeValue.replace(/(?:(?<![\\])")+[^"]*\s*$/, ""); //移除結尾非\"的單獨"，與其之後內容
								singleLangData[currentKey] = wholeValue;
								currentKey = null;
								valueCollection = [];
							}
							currentKey = match[1];
							valueCollection.push(match[2]);
						} else {
							if (currentKey !== null) {
								valueCollection.push(line);
							}
						}
					}

					langData[langKey] = singleLangData;
				}
				weaponType = {};
				elementType = {};
				passiveBonus = {};
				document.getElementById("languageProgress").textContent = getLocalizationText("Progress_Complete");
			} catch (error) {
				document.getElementById("languageProgress").textContent = getLocalizationText("Progress_Failed");
				console.error("Read or parse error:", error);
				alert(error)
				throw error;
			}
			console.timeEnd("Lang");
		}

		function getTextByKey(textKey) {
			for (const langKey in langData) {
				if (langData[langKey][textKey]) {
					return langData[langKey][textKey]
						.replace(/\\n/g, "\n")
						.replace(/\\r/g, "\r")
						.replace(/\\t/g, "\t")
						.replace(/\\'/g, "'")
						.replace(/\\"/g, '"')
						.replace(/\\\\/g, "\\")
						.replace(/(?<!\\)\\/g, "");
				}
			}
			return "";
		}

		async function buildEquipmentData() {
			console.time("Equ");
			document.getElementById("equipmentProgress").textContent = getLocalizationText("Progress_Loading");
			try {
				const baseEquipmentConfigUrl = `${resourceUrlPrefix}Equipment.json`;
				const baseEquipmentConfig = await fetchCheckWithProxy(baseEquipmentConfigUrl)
					.then((res) => res.json())
					.then((data) => data["Equipment"]);

				const equipmentData = {};
				for (const entry of baseEquipmentConfig) {
					const equipmentContent = {};
					const entryID = entry["name"];

					equipmentContent["Name"] = getTextByKey(entryID + "NameKey");
					equipmentContent["FullName"] = equipmentContent["Name"] || entryID;
					equipmentContent["Profile"] = getTextByKey(entryID + "DescriptionKey");
					equipmentContent["Rarity"] = getRarity(entry["accessoryStars"]);
					equipmentContent["Stars"] = generateStarText(entry["accessoryStars"], entry["accessoryStars"]);
					equipmentContent["Stars_Curr"] = entry["accessoryStars"];
					equipmentContent["Stars_Max"] = entry["accessoryStars"];
					equipmentContent["Atk"] = entry["flatAttack"];
					equipmentContent["Hp"] = entry["flatMaxHp"];
					equipmentContent["Speed"] = entry["flatSpeed"];
					equipmentContent["Power"] = calcPowerValEz(
						"Equipment",
						entry["flatAttack"],
						entry["flatMaxHp"],
						entry["flatSpeed"],
						entry["accessoryStars"]
					);
					equipmentContent["Visible"] = entry["visible"] ? true : false;

					equipmentData[entryID] = equipmentContent;
				}

				wholeData["Equipment"] = equipmentData;
				console.timeEnd("Equ");
				document.getElementById("equipmentProgress").textContent = getLocalizationText("Progress_Complete");
			} catch (error) {
				document.getElementById("equipmentProgress").textContent = getLocalizationText("Progress_Failed");
				console.error("Read or parse error:", error);
				alert(error)
				throw error;
			}
		}

		async function buildWeaponData() {
			console.time("Weap");
			document.getElementById("weaponProgress").textContent = getLocalizationText("Progress_Loading");
			try {
				const baseWeaponConfigUrl = `${resourceUrlPrefix}Weapon.json`;
				const baseWeaponConfig = await fetchCheckWithProxy(baseWeaponConfigUrl)
					.then((res) => res.json())
					.then((data) => data["Weapon"]);

				const weaponData = {};
				for (const entry of baseWeaponConfig) {
					const weaponContent = {};
					const entryID = entry["name"];

					weaponContent["Name"] = getTextByKey(entry["family"] + "01NameKey");
					weaponContent["FullName"] = weaponContent["Name"] || entryID;
					weaponContent["Profile"] = getTextByKey(entry["family"] + "01DescriptionKey");
					weaponContent["Rarity"] = getRarity(entry["evolvedStars"]);
					weaponContent["Stars"] = generateStarText(entry["stars"], entry["evolvedStars"]);
					weaponContent["Stars_Curr"] = entry["stars"];
					weaponContent["Stars_Max"] = entry["evolvedStars"];
					weaponContent["forFilter_WeaponType"] = entry["weaponPref"];
					weaponContent["WeaponType"] = getWeaponTypeName(entry["weaponPref"]);
					weaponContent["Cost"] = entry["cost"];
					weaponContent["Atk_Base"] = entry["baseAttack"];
					weaponContent["Hp_Base"] = entry["baseMaxHp"];
					weaponContent["Speed"] = 0;
					weaponContent["Power"] = calcPowerValEz(
						"Weapon",
						entry["baseAttack"],
						entry["baseMaxHp"],
						0,
						entry["evolvedStars"]
					);
					weaponContent["Visible"] = entry["visible"] ? true : false;

					const gachaIntroText = getTextByKey(entryID + "GachaIntroText");
					if (gachaIntroText) weaponContent["GachaIntro"] = gachaIntroText;

					if (entry["passives"]) {
						weaponContent["WeaponSkill"] = [];
						for (const skillID of Object.values(entry["passives"])) {
							const skillDetail = {};
							skillDetail["SkillTitle"] = getTextByKey(skillID + "NameKey");
							skillDetail["SkillDescription"] = getTextByKey(skillID + "DescriptionKey");
							weaponContent["WeaponSkill"].push(skillDetail);
						}
					}

					weaponData[entryID] = weaponContent;
				}

				setExtraEvoCount(weaponData);

				wholeData["Weapon"] = weaponData;
				console.timeEnd("Weap");
				document.getElementById("weaponProgress").textContent = getLocalizationText("Progress_Complete");
			} catch (error) {
				document.getElementById("weaponProgress").textContent = getLocalizationText("Progress_Failed");
				console.error("Read or parse error:", error);
				alert(error)
				throw error;
			}
		}

		async function buildMonsterData() {
			console.time("Mons");
			document.getElementById("monsterProgress").textContent = getLocalizationText("Progress_Loading");
			try {
				//載入基礎設定
				const baseMonsterConfigUrl = `${resourceUrlPrefix}Monster.json`;
				const baseMonsterConfig = await fetchCheckWithProxy(baseMonsterConfigUrl)
					.then((res) => res.json())
					.then((data) => data["Monster"]);

				//載入技能設定
				const abilityDataConfigUrl = `${resourceUrlPrefix}Ability.json`;
				const abilityDataConfig = {};
				await fetchCheckWithProxy(abilityDataConfigUrl)
					.then((res) => res.json())
					.then((data) => {
						for (const ability of data["Ability"]) {
							abilityDataConfig[ability.name] = ability;
						}
					});

				//載入AI威脅度設定
				const aiThreatConfigUrl = `${resourceUrlPrefix}AIThreat.json`;
				const aiThreatConfig = {};
				await fetchCheckWithProxy(aiThreatConfigUrl)
					.then((res) => res.json())
					.then((data) => {
						for (const aiThreat of data["AIThreat"]) {
							(aiThreatConfig[aiThreat.name] ??= {})[aiThreat.condition] = aiThreat.value;
							//if (!aiThreatConfig[aiThreat.name]) aiThreatConfig[aiThreat.name] = {};
							//aiThreatConfig[aiThreat.name][aiThreat.condition] = aiThreat.value;
						}
					});

				//載入技能AI設定
				const skillAIConfigUrl = `${resourceUrlPrefix}AbilityAI.json`;
				const skillAIConfig = await fetchCheckWithProxy(skillAIConfigUrl)
					.then((res) => res.json())
					.then((data) => data["AbilityAI"]);

				//載入Buff設定
				const buffUrl = `${resourceUrlPrefix}Buff.json`;
				const buffConfig = await fetchCheckWithProxy(buffUrl)
					.then((res) => res.json())
					.then((data) => data["Buff"]);

				//開始填入資料
				const monsterData = {};
				for (const entry of baseMonsterConfig) {
					const monsterContent = {};
					const entryID = entry["name"];
					const activeSkillNames = {};

					monsterContent["Name"] = getTextByKey(entryID + "NameKey");
					const name2 = getTextByKey(entryID + "SecondNameKey");
					if (name2 && name2 !== monsterContent["Name"]) monsterContent["Name2"] = name2;
					monsterContent["FullName"] = monsterContent["Name"] ?
						monsterContent["Name2"] ?
							`${monsterContent["Name"]} - ${monsterContent["Name2"]}` :
							monsterContent["Name"] :
						entryID;
					monsterContent["Profile"] = getTextByKey(entryID + "DescriptionKey");
					if (entry["cosmoName"])
						monsterContent["Profile_Ascended"] = getTextByKey(entry["cosmoName"] + "DescriptionKey");
					monsterContent["Rarity"] = getRarity(entry["evolvedStars"]);
					monsterContent["Stars"] = generateStarText(entry["stars"], entry["evolvedStars"]);
					monsterContent["Stars_Curr"] = entry["stars"];
					monsterContent["Stars_Max"] = entry["evolvedStars"];
					monsterContent["PreferredWeapon"] = getWeaponTypeName(entry["weaponPref"]);
					monsterContent["forFilter_Element"] = entry["element"];
					monsterContent["Element"] = getElementTypeName(entry["element"]);
					monsterContent["Cost"] = entry["cost"];
					monsterContent["Atk_Base"] = entry["baseAttack"];
					monsterContent["Hp_Base"] = entry["baseMaxHp"];
					monsterContent["Speed"] = entry["speed"];
					monsterContent["Power"] = calcPowerValEz(
						"Monster",
						entry["baseAttack"],
						entry["baseMaxHp"],
						entry["speed"],
						entry["evolvedStars"]
					);
					monsterContent["Visible"] = entry["visible"] ? true : false;

					if (entry["freeEvolve"]) {
						monsterContent["FreeEvolve"] = {};
						monsterContent["FreeEvolve"]["EvolveLevel"] = entry["freeEvolveLevel"];
						monsterContent["FreeEvolve"]["EvolveTarget"] = entry["freeEvolve"];
					}

					const gachaIntroText = getTextByKey(entryID + "GachaIntroText");
					if (gachaIntroText) monsterContent["GachaIntro"] = gachaIntroText;

					if (entry["leaderBuff"]) {
						monsterContent["LeaderSkill"] = {};
						const skillID = entry["leaderBuff"];
						monsterContent["LeaderSkill"]["SkillTitle"] = getTextByKey(skillID + "NameKey");
						monsterContent["LeaderSkill"]["SkillDescription"] = getTextByKey(skillID + "DescriptionKey");
					}

					if (entry["activeSkills"]) {
						monsterContent["ActiveSkill"] = [];
						for (const skillID of Object.values(entry["activeSkills"])) {
							const skillDetail = {};
							//檢查技能設定中有無指定標題Key
							const skillNameKey = (abilityDataConfig[skillID]["nameKey"] ?? skillID) + "NameKey";
							skillDetail["SkillTitle"] = getTextByKey(skillNameKey);
							activeSkillNames[skillID] = skillDetail["SkillTitle"]; //另存供AI區備用

							//檢查技能設定中有無指定敘述Key
							const skillDescriptionKey =
								(abilityDataConfig[skillID]["descriptionKey"] ?? skillID) + "DescriptionKey";
							skillDetail["SkillDescription"] = getTextByKey(skillDescriptionKey);
							//TU
							skillDetail["TU"] = abilityDataConfig[skillID]["tuCost"] ?? 0;
							//靈氣。0也須帶加號，消耗值是正整數
							const {
								spiritGain,
								spiritCost
							} = abilityDataConfig[skillID];
							skillDetail["Spirit"] = (Number.isInteger(spiritCost) && spiritCost > 0) ? `-${spiritCost}` : (Number.isInteger(spiritGain)) ? `+${spiritGain}` : "+0";

							monsterContent["ActiveSkill"].push(skillDetail);
						}
					}
					if (entry["passives"]) {
						monsterContent["PassiveSkill"] = [];
						for (const skillID of Object.values(entry["passives"])) {
							const skillDetail = {};
							skillDetail["SkillTitle"] = getTextByKey(skillID + "NameKey");
							skillDetail["SkillDescription"] = getTextByKey(skillID + "DescriptionKey");
							monsterContent["PassiveSkill"].push(skillDetail);
						}

						const awkBonusVisible = {};
						for (let i = 1; i <= 4; i++) {
							const passiveSkillID = entry["passives"][i + 1];
							if (passiveSkillID) {
								if (passiveBonus[passiveSkillID]) {
									awkBonusVisible[i] = passiveBonus[passiveSkillID];
								} else {
									if (buffConfig[passiveSkillID]["tags"]) {
										if (buffConfig[passiveSkillID]["tags"].includes("awkHP")) {
											passiveBonus[passiveSkillID] =
												buffConfig[passiveSkillID]["behaviorOverrides"][0]["flatStatBonuses"];
											awkBonusVisible[i] = passiveBonus[passiveSkillID];
										} else if (buffConfig[passiveSkillID]["tags"].includes("awkAtk")) {
											passiveBonus[passiveSkillID] =
												buffConfig[passiveSkillID]["behaviorOverrides"][0]["flatStatBonuses"];
											awkBonusVisible[i] = passiveBonus[passiveSkillID];
										} else if (buffConfig[passiveSkillID]["tags"].includes("awkWep")) {
											passiveBonus[passiveSkillID] = buffConfig[passiveSkillID]["behaviorOverrides"][0];
											passiveBonus[passiveSkillID]["weaponPref"] = getWeaponTypeName(passiveBonus[passiveSkillID]["weaponPref"]);
											awkBonusVisible[i] = passiveBonus[passiveSkillID];
										}
									}
								}
							}
						}
						if (Object.keys(awkBonusVisible).length > 0) monsterContent["PassiveBonusVisible"] = awkBonusVisible;
					}

					if (entry["summonableMonsters"]) {
						monsterContent["Conjures"] = [];
						for (const conjures of entry["summonableMonsters"]) {
							monsterContent["Conjures"].push(conjures);
						}
					}

					const dialogGroup = {};
					const dialogList = {
						gachaVoices: ["Gacha", "Gacha"],
						loginVoices: ["Login", "Login"],
						tapVoices: ["Tap", "Tap"],
						idleVoices: ["Idle", "Idle"],
					};
					for (const [dialogType, dialogParams] of Object.entries(dialogList)) {
						if (entry[dialogType]) {
							const dialogSet = [];
							for (const dialogNum of entry[dialogType]) {
								dialogSet.push(getTextByKey(entry["family"] + dialogParams[0] + dialogNum + "Key"));
							}
							dialogGroup[dialogParams[1]] = dialogSet;
						}
					}
					if (Object.keys(dialogGroup).length > 0) monsterContent["Dialog"] = dialogGroup;

					monsterContent["AiLogic"] = {};
					monsterContent["AiLogic"]["PickWeight"] = entry["aiTargetPickWeight"];
					if (aiThreatConfig[entryID]) monsterContent["AiLogic"]["Threat"] = aiThreatConfig[entryID];
					monsterContent["AiLogic"]["SkillUse"] = {};
					for (const [fakeIndex, skillID] of Object.entries(entry["activeSkills"])) {
						const skillAISetting = {};
						const skillAIKey = entry["activeSkillsAI"]?.[fakeIndex] ?
							entry["activeSkillsAI"][fakeIndex] :
							abilityDataConfig[skillID]["config"] + "_AI";

						if (skillAIConfig[skillAIKey]["baseAITargetingWeight"])
							skillAISetting["BaseWeight"] = skillAIConfig[skillAIKey]["baseAITargetingWeight"];
						if (skillAIConfig[skillAIKey]["globalScalorsToIgnore"])
							skillAISetting["Ignore"] = skillAIConfig[skillAIKey]["globalScalorsToIgnore"];
						if (skillAIConfig[skillAIKey]["aiTargetingSourceMonsterConditions"])
							skillAISetting["Source"] = skillAIConfig[skillAIKey]["aiTargetingSourceMonsterConditions"];
						if (skillAIConfig[skillAIKey]["aiTargetingMonsterConditions"])
							skillAISetting["Target"] = skillAIConfig[skillAIKey]["aiTargetingMonsterConditions"];

						monsterContent["AiLogic"]["SkillUse"][activeSkillNames[skillID]] = skillAISetting;
					}

					monsterData[entryID] = monsterContent;
				}

				setExtraEvoCount(monsterData);
				await setRelationshipData(monsterData);

				wholeData["Monster"] = monsterData;
				console.timeEnd("Mons");
				document.getElementById("monsterProgress").textContent = getLocalizationText("Progress_Complete");
			} catch (error) {
				document.getElementById("monsterProgress").textContent = getLocalizationText("Progress_Failed");
				console.error("Read or parse error:", error);
				alert(error)
				throw error;
			}
		}

		function setExtraEvoCount(jsonData) {
			for (const id in jsonData) {
				const familyName = id.slice(0, -2);
				const numInFamily = Number(id.slice(-2));
				let evoNotFreeCount = numInFamily - 1;
				for (let i = numInFamily - 1; i > 0; i--) {
					if (jsonData?.[familyName + String(i).padStart(2, "0")]?.["FreeEvolve"]) evoNotFreeCount--;
				}
				if (evoNotFreeCount) jsonData[id]["ExtraEvoInitialCount"] = evoNotFreeCount;
			}
		}

		async function setRelationshipData(monsterData) {
			let relationshipData;
			try {
				relationshipData = await generateRelationshipData();
			} catch (e) {
				console.log("Unable to capture relationship data", e);
				const relationshipDataUrl = "Config/Relationship.json";
				relationshipData = await fetchCheck(relationshipDataUrl).then((res) => res.json())["Relationship"];
			}

			for (const [relationID, relationDetail] of Object.entries(relationshipData)) {
				const relationshipName = getTextByKey(relationDetail["Name"]);
				for (const memberID of relationDetail["Families"]) {
					const clanID = memberID.slice(0, -2);
					for (let i = 1; i <= 3; i++) {
						charID = clanID + String(i).padStart(2, "0");
						if (monsterData[charID]) {
							const relationGroup = {};
							relationGroup["RelationshipName"] = relationshipName;
							relationGroup["RelationshipFamily"] = relationDetail["Families"];
							relationGroup["RelationshipBuff"] = relationDetail["Bonus"]
								.replace("ATK", getLocalizationText("Ralationship_BonusAtk"))
								.replace("HP", getLocalizationText("Ralationship_BonusHp"));
							monsterData[charID]["Relationship"] ??= {};
							monsterData[charID]["Relationship"][relationID] = relationGroup;
						}
					}
				}
			}
		}

		async function getRelationshipRaw() {
			const userDevice = "Google Pixel 6";
			const userOs = "Android OS 13";
			const evtVersion = (
				await fetchCheckWithProxy(`${resourceUrlPrefix}Android/hashes.json`).then((res) => res.json())
			)["ver"];
			const uuid = crypto.randomUUID();

			let uid;
			let clid;
			//從快取讀uid，不然創新帳號獲取
			cache_NewAcc = JSON.parse(localStorage.getItem("NewAcc"));
			if (cache_NewAcc) {
				uid = cache_NewAcc["uid"];
				clid = cache_NewAcc["clid"];
			} else {
				const baseUrl_NewUser = "https://api.prd.evertaleserver.com/newuser";
				const params_NewUser = {
					platform: "android",
					device: userDevice,
					os: userOs,
					adid: "unknown",
					shard: "1",
					req: "newuser",
					lang: "en",
					region: "JST",
					requnique: "1",
				};
				const finalUrl_NewUser = `${baseUrl_NewUser}?${new URLSearchParams(params_NewUser).toString()}`;
				const newuserResponse = await fetchCheckWithProxy(finalUrl_NewUser).then((res) => res.json());
				localStorage.setItem("NewAcc", JSON.stringify(newuserResponse["newuser"]));
				uid = newuserResponse["newuser"]["uid"];
				clid = newuserResponse["newuser"]["clid"];
			}

			//登入以獲取sesid
			const baseUrl_Login = "https://api.prd.evertaleserver.com/login";
			const params_Login = {
				uid: uid,
				clid: clid,
				platform: "android",
				device: userDevice,
				shardpick: "1",
				bundle: "com.zigzagame.evertale",
				ver: evtVersion,
				os: userOs,
				vid: (Array.from({ length: 32 }, () => Math.floor(Math.random() * 16).toString(16)).join('')),
				adid: "unknown",
				req: "login",
				lang: "en",
				region: "JST",
				unique: uuid,
				requnique: "1",
			};
			const finalUrl_Login = `${baseUrl_Login}?${new URLSearchParams(params_Login).toString()}`;
			const loginResponse = await fetchCheckWithProxy(finalUrl_Login).then((res) => res.json());
			const sesid = loginResponse["login"]["sesid"];

			//請求獲取Relationship資訊
			const baseUrl_Relationship = "https://api.prd.evertaleserver.com/screenvalues";
			const params_Relationship = {
				screen: "Relationships",
				activeLineup: "1",
				activeEventLineup: "1",
				req: "screenvalues",
				reqid: "1",
				sesid: sesid,
				requnique: "1",
			};
			const finalUrl_Relationship = `${baseUrl_Relationship}?${new URLSearchParams(
				params_Relationship
			).toString()}`;
			const relationshipResponse = await fetchCheckWithProxy(finalUrl_Relationship).then((res) => res.json());

			return relationshipResponse;
		}

		async function generateRelationshipData() {
			const relationshipRaw = JSON.parse((await getRelationshipRaw())["screenvalues"]["relationships"]);
			const relationshipData = {};

			for (const relationDetail of relationshipRaw) {
				const oneRelationship = {};
				oneRelationship["Name"] = relationDetail["locKey"];
				oneRelationship["Families"] = [];
				for (const aMember of relationDetail["families"]) {
					oneRelationship["Families"].push(aMember["Item1"]);
				}
				if (relationDetail["flatAtk"]) oneRelationship["Bonus"] = `ATK+${relationDetail["flatAtk"]}`;
				if (relationDetail["flatHp"]) oneRelationship["Bonus"] = `HP+${relationDetail["flatHp"]}`;
				if (relationDetail["perAtk"]) oneRelationship["Bonus"] = `ATK+${relationDetail["perAtk"]}%`;
				if (relationDetail["perHp"]) oneRelationship["Bonus"] = `HP+${relationDetail["perHp"]}%`;

				relationshipData[relationDetail["name"]] = oneRelationship;
			}
			return relationshipData;
		}

		function getRarity(stars) {
			switch (stars) {
				case 6:
					return "SSR";
				case 5:
					return "SR";
				case 4:
					return "R";
				case 3:
				case 2:
				case 1:
				case 0:
					return "N";
				default:
					return "?";
			}
		}

		function generateStarText(currStar, maxStar) {
			if (maxStar >= currStar) {
				if (maxStar <= 0) {
					return 0;
				} else {
					return "★".repeat(currStar) + "☆".repeat(maxStar - currStar);
				}
			} else {
				return "Stars Error";
			}
		}

		function calcPowerValEz(type, atk, hp, spd, maxStar) {
			const weight_atk = 30;
			const weight_hp = 6;
			const weight_spd = type !== "Equipment" ? 0 : 180;

			let powVal = weight_atk * atk + weight_hp * hp + weight_spd * spd;
			if (type === "Monster") {
				if (maxStar === 6) powVal *= 2;
				if (maxStar === 5) powVal *= 1.5;
			}
			return powVal;
		}

		function getWeaponTypeName(weaponTypeKey) {
			if (!weaponTypeKey) return "-";
			if (weaponType[weaponTypeKey]) return weaponType[weaponTypeKey];
			weaponType[weaponTypeKey] = getTextByKey(weaponTypeKey + "NameKey");
			return weaponType[weaponTypeKey];
		}

		function getElementTypeName(elementTypeKey) {
			if (!elementTypeKey) return "-";
			if (elementType[elementTypeKey]) return elementType[elementTypeKey];
			elementType[elementTypeKey] = getTextByKey(elementTypeKey + "Key");
			return elementType[elementTypeKey];
		}
	</script>

	<script>
		/*=====資訊顯示區塊=====*/
		const imageSource = {
			Monster: { domain: "https://monster.evertale.qzz.io/", filelist: [] },
			Weapon: { domain: "https://weapon.evertale.qzz.io/", filelist: [] },
			Equipment: { domain: "https://equipment.evertale.qzz.io/", filelist: [] },
			Tachie: { domain: "https://tachie.evertale.qzz.io/", filelist: [] },
		}

		document.addEventListener("DOMContentLoaded", setImageFilelist);

		let initTitle = document.title;
		let currentDisplayCategory = null;
		let currentDisplayID = null;

		function displayData(id, myCategory) {
			id ??= document.getElementById("targetSelect").value;
			if (id == "") return;

			currentDisplayCategory = myCategory ?? unit_category;
			currentDisplayID = id;

			collapseReset();
			document.title = `${wholeData[currentDisplayCategory][id]["FullName"]} | ${initTitle}`;

			document.getElementById("codeName").innerHTML = `<a href="?id=${id}&category=${currentDisplayCategory}">${id}</a>`;
			document.getElementById("bigName").textContent = wholeData[currentDisplayCategory][id]["Name"] || id;
			if (wholeData[currentDisplayCategory][id]["Name2"]) {
				document.getElementById("subName").classList.remove("hidden");
				document.getElementById("subName").textContent = wholeData[currentDisplayCategory][id]["Name2"];
			} else {
				document.getElementById("subName").classList.add("hidden");
			}

			setGeneralStats(id);
			setProfile(id);
			setLeaderSkill(id);
			setWeaponSkill(id);
			setActiveSkill(id);
			setPassiveSkill(id);
			setSummonableMonsters(id);
			setGachaIntro(id);
			setDialog(id);
			setAiLogic(id);
			setRelationship(id);
			initStatsInput(id);
			setFullImage(id);

			document.getElementById("mainBlock").classList.remove("hidden");
			document.getElementById("mainBlock").scrollIntoView();
		}

		function setGeneralStats(id) {
			document.getElementById("generalStatsArea").classList.remove("hidden");

			const headshot_fileName = (currentDisplayCategory === "Monster") ? id : `${id.slice(0, -2)}01`;
			document.querySelector("#headshot_General img")?.remove();
			document.querySelector("#headshot_Cosmo img")?.remove();
			if (headshot_fileName != null) {
				const headshotGeneral = checkImageExisting(currentDisplayCategory, "headshot", headshot_fileName, true);
				document.getElementById("headshot_General").appendChild(headshotGeneral);
				if (wholeData[currentDisplayCategory][id]["Profile_Ascended"] != null) {
					const id_cosmo = id.slice(0, -2) + "03";
					const headshotCosmo = checkImageExisting(currentDisplayCategory, "headshot", id_cosmo, true);
					document.getElementById("headshot_Cosmo").appendChild(headshotCosmo);
					document.getElementById("headshot_Cosmo").classList.remove("hidden");
				} else {
					document.getElementById("headshot_Cosmo").classList.add("hidden");
				}
				document.getElementById("headshotZone").classList.remove("hidden");
			} else {
				document.getElementById("headshot_Cosmo").classList.add("hidden");
				document.getElementById("headshotZone").classList.add("hidden");
			}

			if (currentDisplayCategory === "Equipment") {
				document.querySelector("#atk .infoTitle").textContent = getLocalizationText("Atk");
				document.querySelector("#hp .infoTitle").textContent = getLocalizationText("Hp");
				document.getElementById("powerHint").classList.add("hidden");
			} else {
				document.querySelector("#atk .infoTitle").textContent = getLocalizationText("Atk_Base");
				document.querySelector("#hp .infoTitle").textContent = getLocalizationText("Hp_Base");
				document.getElementById("powerHint").classList.remove("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["Rarity"] != null) {
				document.getElementById("rarity").classList.remove("hidden");
				const rarityFile = {
					N: "icon/RarityIconN01.png",
					R: "icon/RarityIconR01.png",
					SR: "icon/RarityIconSr01.png",
					SSR: "icon/RarityIconSsr01.png"
				};
				document.querySelector("#rarity .infoValue img").src = rarityFile[wholeData[currentDisplayCategory][id]["Rarity"]] || "";
			} else {
				document.getElementById("rarity").classList.add("hidden");
				document.querySelector("#rarity .infoValue img").src = ""
			}

			if (wholeData[currentDisplayCategory][id]["Stars"] != null) {
				document.getElementById("stars").classList.remove("hidden");
				const starBlackFile = "icon/IconBlackRarityStar01_old.png";
				const starTrueFile = {
					N: "icon/IconBrownStarBronze01_old.png",
					R: "icon/IconGreyStarSilver01_old.png",
					SR: "icon/IconYellowStar01_old.png",
					SSR: "icon/IconRainbowStar01_old.png"
				};
				const starContent = String(wholeData[currentDisplayCategory][id]["Stars"]).
					replaceAll("☆", `<img src="${starBlackFile}">`).
					replaceAll("★", `<img src="${starTrueFile[wholeData[currentDisplayCategory][id]["Rarity"]]}">`);
				document.querySelector("#stars .infoValue").innerHTML = starContent;
			} else {
				document.getElementById("stars").classList.add("hidden");
				document.querySelector("#stars .infoValue").innerHTML = "";
			}

			if (wholeData[currentDisplayCategory][id]["PreferredWeapon"] != null) {
				document.getElementById("preferredWeapon").classList.remove("hidden");
				const prefWeap = getCodeByShowedName(wholeData[currentDisplayCategory][id]["PreferredWeapon"]);
				document.querySelector("#preferredWeapon .infoValue").innerHTML = prefWeap ? `<img src="icon/${prefWeap}.png">` : "-";

				if (wholeData[currentDisplayCategory][id]["PassiveBonusVisible"]) {
					for (const bonusEffect of Object.values(wholeData[currentDisplayCategory][id]["PassiveBonusVisible"])) {
						const preferredWeapon2Name = bonusEffect?.["weaponPref"];
						if (preferredWeapon2Name) {
							const prefWeap2 = getCodeByShowedName(preferredWeapon2Name);
							document.querySelector("#preferredWeapon .infoValue").innerHTML += prefWeap2 ? `<img id="prefWeapon2" src="icon/${prefWeap2}.png">` : "-";
							/*
							const prefWeap2_inner = document.createElement("span");
							prefWeap2_inner.id = "prefWeapon2";
							prefWeap2_inner.textContent = preferredWeapon2Name;
							const prefWeap2 = document.createElement("div");
							prefWeap2.appendChild(prefWeap2_inner);
							document.querySelector("#preferredWeapon .infoValue").appendChild(prefWeap2);
							*/
						}
					}
				}
			} else {
				document.getElementById("preferredWeapon").classList.add("hidden");
				document.querySelector("#preferredWeapon .infoValue").innerHTML = "";
			}

			if (wholeData[currentDisplayCategory][id]["WeaponType"] != null) {
				document.getElementById("weaponType").classList.remove("hidden");
				document.querySelector("#weaponType .infoValue img").src = `icon/${getCodeByShowedName(wholeData[currentDisplayCategory][id]["WeaponType"])}.png`;
			} else {
				document.getElementById("weaponType").classList.add("hidden");
				document.querySelector("#weaponType .infoValue img").src = ""
			}

			if (wholeData[currentDisplayCategory][id]["Element"] != null) {
				document.getElementById("element").classList.remove("hidden");
				document.querySelector("#element .infoValue img").src = `icon/${getCodeByShowedName(wholeData[currentDisplayCategory][id]["Element"])}.png`;
			} else {
				document.getElementById("element").classList.add("hidden");
				document.querySelector("#element .infoValue img").src = ""
			}

			if (wholeData[currentDisplayCategory][id]["Cost"] != null) {
				document.getElementById("cost").classList.remove("hidden");
				document.querySelector("#cost .infoValue").textContent = wholeData[currentDisplayCategory][id]["Cost"];
			} else {
				document.getElementById("cost").classList.add("hidden");
			}

			if (
				(wholeData[currentDisplayCategory][id]["Atk_Base"] != null) |
				(wholeData[currentDisplayCategory][id]["Atk"] != null)
			) {
				document.getElementById("atk").classList.remove("hidden");
				document.querySelector("#atk .infoValue").textContent =
					wholeData[currentDisplayCategory][id]["Atk_Base"] ?? wholeData[currentDisplayCategory][id]["Atk"];
			} else {
				document.getElementById("atk").classList.add("hidden");
			}

			if (
				(wholeData[currentDisplayCategory][id]["Hp_Base"] != null) |
				(wholeData[currentDisplayCategory][id]["Hp"] != null)
			) {
				document.getElementById("hp").classList.remove("hidden");
				document.querySelector("#hp .infoValue").textContent =
					wholeData[currentDisplayCategory][id]["Hp_Base"] ?? wholeData[currentDisplayCategory][id]["Hp"];
			} else {
				document.getElementById("hp").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["Speed"] != null) {
				document.getElementById("speed").classList.remove("hidden");
				document.querySelector("#speed .infoValue").textContent = wholeData[currentDisplayCategory][id]["Speed"];
			} else {
				document.getElementById("speed").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["Power"] != null) {
				document.getElementById("power").classList.remove("hidden");
				document.querySelector("#power .infoValue").textContent = wholeData[currentDisplayCategory][id]["Power"];
			} else {
				document.getElementById("power").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["FreeEvolve"] != null) {
				document.getElementById("freeEvo").classList.remove("hidden");
				const evoLv = `Lv.${wholeData[currentDisplayCategory][id]["FreeEvolve"]["EvolveLevel"]}`;
				const evoTarget = setNameAndLink(
					wholeData[currentDisplayCategory][id]["FreeEvolve"]["EvolveTarget"],
					"Monster",
					true,
					false
				);
				document.querySelector("#freeEvo .infoValue").innerHTML = `${evoLv}<br>${evoTarget.outerHTML}`;
			} else {
				document.getElementById("freeEvo").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["Visible"]) {
				document.getElementById("visible").classList.remove("hidden");
				document.querySelector("#visible .infoValue").textContent = "✔";
			} else {
				document.getElementById("visible").classList.remove("hidden");
				document.querySelector("#visible .infoValue").textContent = "✗";
			}
		}

		function setProfile(id) {
			if (wholeData[currentDisplayCategory][id]["Profile"]) {
				document.getElementById("profileArea").classList.remove("hidden");
				document.getElementById("profileText").innerHTML = wholeData[currentDisplayCategory][id]["Profile"].replaceAll("\n", "<br>");

				document.getElementById("hasAscended")?.remove();
				if (wholeData[currentDisplayCategory][id]["Profile_Ascended"] != null) {
					const templateHasAscended = document.getElementById("template-hasAscended").content.cloneNode(true);
					templateHasAscended.getElementById("profileAscendedTitle").textContent =
						getLocalizationText("AscendedPart");
					templateHasAscended.getElementById("profileAscendedText").innerHTML =
						wholeData[currentDisplayCategory][id]["Profile_Ascended"].replaceAll("\n", "<br>");
					document.getElementById("profileContent").appendChild(templateHasAscended);
				}
			} else {
				document.getElementById("profileArea").classList.add("hidden");
			}
		}

		function setLeaderSkill(id) {
			if (wholeData[currentDisplayCategory][id]["LeaderSkill"]) {
				document.getElementById("leaderSkillArea").classList.remove("hidden");
				document.getElementById("leaderSkillName").innerText =
					wholeData[currentDisplayCategory][id]["LeaderSkill"]["SkillTitle"];
				document.getElementById("leaderSkillDecription").innerText =
					wholeData[currentDisplayCategory][id]["LeaderSkill"]["SkillDescription"];
			} else {
				document.getElementById("leaderSkillArea").classList.add("hidden");
			}
		}

		function setWeaponSkill(id) {
			if (wholeData[currentDisplayCategory][id]["WeaponSkill"]) {
				document.getElementById("weaponSkillArea").classList.remove("hidden");
				document.getElementById("weaponSkillName").innerText =
					wholeData[currentDisplayCategory][id]["WeaponSkill"][0]["SkillTitle"];
				document.getElementById("weaponSkillDecription").innerText =
					wholeData[currentDisplayCategory][id]["WeaponSkill"][0]["SkillDescription"];
			} else {
				document.getElementById("weaponSkillArea").classList.add("hidden");
			}
		}

		function setActiveSkill(id) {
			if (wholeData[currentDisplayCategory][id]["ActiveSkill"]) {
				document.getElementById("activeSkillArea").classList.remove("hidden");
				document.getElementById("activeSkillContent").innerHTML = "";

				for (const [index, mySkill] of wholeData[currentDisplayCategory][id]["ActiveSkill"].entries()) {
					const templateActiveSkill = document.getElementById("template-activeSkill").content.cloneNode(true);
					templateActiveSkill.querySelector(".activeSkillDetail").id = "activeSkill_" + (index + 1);
					templateActiveSkill.querySelector(".activeSkillName").innerText = mySkill["SkillTitle"];
					templateActiveSkill.querySelector(".activeSkillSpirit").lastChild.textContent = mySkill["Spirit"];
					templateActiveSkill.querySelector(".activeSkillTU").lastChild.textContent = mySkill["TU"];
					templateActiveSkill.querySelector(".activeSkillDecription").innerText = mySkill["SkillDescription"];

					document.getElementById("activeSkillContent").appendChild(templateActiveSkill);
				}
			} else {
				document.getElementById("activeSkillArea").classList.add("hidden");
			}
		}

		function setPassiveSkill(id) {
			if (wholeData[currentDisplayCategory][id]["PassiveSkill"]) {
				document.getElementById("passiveSkillArea").classList.remove("hidden");
				document.getElementById("passiveSkillContent").innerHTML = "";

				for (const [index, mySkill] of wholeData[currentDisplayCategory][id]["PassiveSkill"].entries()) {
					const templateActiveSkill = document.getElementById("template-passiveSkill").content.cloneNode(true);
					templateActiveSkill.querySelector(".passiveSkillDetail").id = "passiveSkill_" + (index + 1);
					templateActiveSkill.querySelector(".passiveSkillName").innerText = mySkill["SkillTitle"];
					templateActiveSkill.querySelector(".passiveSkillDecription").innerText = mySkill["SkillDescription"];

					document.getElementById("passiveSkillContent").appendChild(templateActiveSkill);
				}
			} else {
				document.getElementById("passiveSkillArea").classList.add("hidden");
			}
		}

		function setGachaIntro(id) {
			if (wholeData[currentDisplayCategory][id]["GachaIntro"]) {
				document.getElementById("gachaIntroArea").classList.remove("hidden");
				document.getElementById("gachaIntroText").innerText = wholeData[currentDisplayCategory][id]["GachaIntro"];
			} else {
				document.getElementById("gachaIntroArea").classList.add("hidden");
			}
		}

		function setDialog(id) {
			if (wholeData[currentDisplayCategory][id]["Dialog"]) {
				document.getElementById("dialogArea").classList.remove("hidden");
				document.getElementById("dialogContent").innerHTML = "";

				const dailogSort = {
					Gacha: "Gacha",
					Login: "Login",
					Tap: "Tap",
					Idle: "Idle",
				};

				for (const [key, title] of Object.entries(dailogSort)) {
					if (!wholeData[currentDisplayCategory][id]["Dialog"][title]) continue;

					const templateDialog = document.getElementById("template-dialog").content.cloneNode(true);
					templateDialog.querySelector(".dialogGroup").id = "dialog_" + key;
					templateDialog.querySelector(".dialogGroupTitle").innerText = getLocalizationText(`Dialog_${title}`);

					for (const dialogText of wholeData[currentDisplayCategory][id]["Dialog"][title]) {
						if (!dialogText) continue;
						const templateDialogText = templateDialog.querySelector(".dialogText").cloneNode(true);
						templateDialogText.innerText = dialogText;
						templateDialog.querySelector(".dialogGroup").appendChild(templateDialogText);
					}
					//若無添加，則只有模板當初的2子元素
					if (templateDialog.querySelector(".dialogGroup").children.length <= 2) continue;

					templateDialog.querySelector(".dialogText").remove();
					document.getElementById("dialogContent").appendChild(templateDialog);
				}
			} else {
				document.getElementById("dialogArea").classList.add("hidden");
			}
		}

		function setAiLogic(id) {
			if (wholeData[currentDisplayCategory][id]["AiLogic"]) {
				document.getElementById("aiLogicArea").classList.remove("hidden");
				//刪除最外層的{}，並統一減少1縮排
				let jsonText = JSON.stringify(wholeData[currentDisplayCategory][id]["AiLogic"], null, "\t");
				jsonText = jsonText.split("\n").slice(1, -1);
				jsonText = jsonText.map((line) => line.replace(/^\t/, ""));
				jsonText = jsonText.join("\n");

				jsonText = jsonText
					.replaceAll('"PickWeight"', `"${getLocalizationText("Ai_PickWeight")}"`)
					.replaceAll('"Threat"', `"${getLocalizationText("Ai_Threat")}"`)
					.replaceAll('"SkillUse"', `"${getLocalizationText("Ai_SkillUse")}"`)
					.replaceAll('"BaseWeight"', `"${getLocalizationText("Ai_BaseWeight")}"`)
					.replaceAll('"Ignore"', `"${getLocalizationText("Ai_Ignore")}"`)
					.replaceAll('"Source"', `"${getLocalizationText("Ai_Source")}"`)
					.replaceAll('"Target"', `"${getLocalizationText("Ai_Target")}"`);

				document.getElementById("aiLogicContent").innerText = jsonText;
			} else {
				document.getElementById("aiLogicArea").classList.add("hidden");
			}
		}

		function getFullNameAddStarsOrRarity(id, category, addStars = true, addRarity = false) {
			let longName = wholeData[category][id]["FullName"];
			if (addStars) longName += ` (${wholeData[category][id]["Stars"]})`;
			if (addRarity) longName += ` (${wholeData[category][id]["Rarity"]})`;
			return longName;
		}

		function analyzeUrlParams() {
			try {
				const params = new URLSearchParams(window.location.search);
				if (!params.toString()) return;
				history.replaceState(null, "", window.location.pathname);

				/*
				//語言參數處理移至載入時
				const lang = params.get("lang");
				if (lang) {
					const languagePick = document.getElementById("languagePick");
					for (let option of languagePick.options) {
						if (option.value === lang || option.dataset.shortname === lang) {
							document.getElementById("languagePick").value = option.value;
							setPickLang();
							break;
						}
					}
				}
				*/

				const id = params.get("id");
				let category = params.get("category");
				if (id || category) {
					if (!id && category) {
						//不能只有category
						throw new Error("Missing id");
					}

					if (id && !category) {
						//若沒傳入category則遍歷搜尋
						category = (() => {
							for (const [type, ids] of Object.entries(wholeData)) {
								if (id in ids) return type;
							}
							throw new Error("Invalid id");
						})();
					}

					if (wholeData?.[category]?.[id]) {
						displayData(id, category);
					} else {
						throw new Error("Invalid id or category");
					}
				}
			} catch (e) {
				alert(e);
				console.error(e);
			}
		}

		function setNameAndLink(id, category, addStars = true, addRarity = false) {
			const linkElement = document.createElement("a");
			linkElement.href = `?id=${id}&category=${category}`;
			const textContent = getFullNameAddStarsOrRarity(id, category, addStars, addRarity);
			const img = checkImageExisting(category, "headshot", ((category === "Monster") ? id : `${id.slice(0, -2)}01`), true);
			linkElement.append(img, textContent);
			return linkElement;
		}

		function setSummonableMonsters(id) {
			if (wholeData[currentDisplayCategory][id]["Conjures"]) {
				document.getElementById("summonableMonstersArea").classList.remove("hidden");
				const combination = wholeData[currentDisplayCategory][id]["Conjures"]
					.map((conjureID) => setNameAndLink(conjureID, "Monster", true, false).outerHTML)
					.join("<br>");
				document.getElementById("summonableMonstersContent").innerHTML = combination;
			} else {
				document.getElementById("summonableMonstersArea").classList.add("hidden");
			}
		}

		function setRelationship(id) {
			if (wholeData[currentDisplayCategory][id]["Relationship"]) {
				document.getElementById("relationshipArea").classList.remove("hidden");
				document.getElementById("relationshipContent").innerHTML = "";

				for (const oneRelationship of Object.values(wholeData[currentDisplayCategory][id]["Relationship"])) {
					const templateRelationship = document.getElementById("template-relationship").content.cloneNode(true);
					templateRelationship.querySelector(".relationshipName").innerText = oneRelationship["RelationshipName"];
					templateRelationship.querySelector(".relationshipBonus").innerText = oneRelationship[
						"RelationshipBuff"
					].replace("+", "\n+");

					const memberlist = document.createElement("ul");
					for (const charID of oneRelationship["RelationshipFamily"]) {
						const listItem = document.createElement("li");
						listItem.appendChild(setNameAndLink(charID, "Monster", false, true));
						memberlist.appendChild(listItem);
					}
					templateRelationship.querySelector(".relationshipMembers").appendChild(memberlist);

					document.getElementById("relationshipContent").appendChild(templateRelationship);
				}
			} else {
				document.getElementById("relationshipArea").classList.add("hidden");
			}
		}

		function setFullImage(id) {
			document.getElementById("imageContent").innerHTML = "";

			const id_LowerCase = id.toLowerCase()
			const portrait_fileName = (currentDisplayCategory === "Monster") ? id_LowerCase : `${id_LowerCase.slice(0, -2)}01`;
			const portraitGeneral = checkImageExisting(currentDisplayCategory, "portrait", portrait_fileName);
			if (portraitGeneral) {
				document.getElementById("imageContent").appendChild(portraitGeneral);
				//滿覺角
				if (wholeData[currentDisplayCategory][id]["Profile_Ascended"] != null) {
					const id_cosmo = id_LowerCase.slice(0, -2) + "03";
					const portraitCosmo = checkImageExisting(currentDisplayCategory, "portrait", id_cosmo);
					if (portraitCosmo) {
						document.getElementById("imageContent").appendChild(portraitCosmo);
					}
					//滿覺橫圖
					const landscapePic = checkImageExisting(currentDisplayCategory, "portrait", id_cosmo + "_ex");;
					if (landscapePic) {
						document.getElementById("imageContent").appendChild(landscapePic);
					}
				}
				//立繪
				if (currentDisplayCategory === "Monster") {
					const tachieImg = checkImageExisting("Tachie", "tachie", id_LowerCase);
					if (tachieImg) {
						document.getElementById("imageContent").appendChild(tachieImg);
					}
				}
				document.getElementById("imageArea").classList.remove("hidden");
			} else {
				document.getElementById("imageArea").classList.add("hidden");
			}
		}

		async function setImageFilelist() {
			for (const imgData of Object.values(imageSource)) {
				if (imgData["filelist"].length === 0) {
					imgData["filelist"] = await fetchCheck(imgData["domain"] + "filelist.json").then((res) => res.json());
				}
			}
		}

		function checkImageExisting(img_category, img_type, img_name, forceTrue = false) {
			const imgPath = ((img_category.toLowerCase() === img_type.toLowerCase()) ? `${img_name}.png` : `${img_type}/${img_name}.png`).toLowerCase();
			if (forceTrue || imageSource[img_category]["filelist"].includes(imgPath)) {
				const newImage = document.createElement("img")
				newImage.src = `${imageSource[img_category]["domain"]}/${imgPath}`.toLowerCase();
				return newImage;
			} else {
				return null;
			}
		}

		function collapseContent(triggerElement) {
			triggerElement.innerText = !triggerElement.nextElementSibling.classList.contains("hidden") ? "⊕" : "⊖";
			triggerElement.nextElementSibling.classList.toggle("hidden");
		}

		function collapseReset() {
			document.querySelectorAll(".collapseButton").forEach(function (el) {
				el.nextElementSibling.classList.remove("hidden");
				el.innerText = "⊖";
			});
		}
	</script>
	<script>
		/*=====戰力計算區塊=====*/
		let nowInfiniteMode = false;

		function initStatsInput(id) {
			if (currentDisplayCategory !== "Equipment") {
				id ??= currentDisplayID;
				document.getElementById("input_atkBase").value = 0;
				document.getElementById("input_hpBase").value = 0;
				document.getElementById("input_starsCurrent").value = 0;
				document.getElementById("input_starsMax").value = 0;
				document.getElementById("input_limitBreak").value = 0;
				document.getElementById("input_level").value = 1;
				document.getElementById("input_awakening").value = 0;
				document.getElementById("input_cosmo").checked = false;
				document.getElementById("input_cosmo").disabled = true;
				document.getElementById("input_boost").value = 0;
				document.getElementById("input_refine").value = "0.00";
				document.getElementById("input_mastery").value = 0;

				document.getElementById("infiniteMode").checked = false;
				nowInfiniteMode = false;
				document.getElementById("result_atk").value = "";
				document.getElementById("result_hp").value = "";
				document.getElementById("result_atk").dataset.trueval = 0;
				document.getElementById("result_hp").dataset.trueval = 0;
				document.getElementById("result_atk").dataset.awkbonus = 0;
				document.getElementById("result_hp").dataset.awkbonus = 0;
				document.getElementById("result_power").value = "";
				document.getElementById("resultInvolvePassive").checked = true;

				setStatsVal(id);

				document.getElementById("powerCalculatorArea").classList.remove("hidden");
			} else {
				document.getElementById("powerCalculatorArea").classList.add("hidden");
			}
		}

		function setStatsVal(id) {
			id ??= currentDisplayID;

			document.getElementById("input_atkBase").value = wholeData[currentDisplayCategory][id]["Atk_Base"];
			document.getElementById("input_atkBase").readOnly = true;
			document.getElementById("hint_atkBase").classList.add("hidden");

			document.getElementById("input_hpBase").value = wholeData[currentDisplayCategory][id]["Hp_Base"];
			document.getElementById("input_hpBase").readOnly = true;
			document.getElementById("hint_hpBase").classList.add("hidden");

			document.getElementById("input_starsCurrent").value = wholeData[currentDisplayCategory][id]["Stars_Curr"];
			document.getElementById("input_starsCurrent").readOnly = true;
			document.getElementById("hint_starsCurrent").classList.add("hidden");

			document.getElementById("input_starsMax").value = wholeData[currentDisplayCategory][id]["Stars_Max"];
			document.getElementById("input_starsMax").readOnly = true;
			document.getElementById("hint_starsMax").classList.add("hidden");

			if (wholeData[currentDisplayCategory][id]["Stars_Max"] > 3) {
				document.getElementById("pc_limitBreakInput").classList.remove("hidden");
				setLimitBreakLabel(id);
			} else {
				document.getElementById("pc_limitBreakInput").classList.add("hidden");
				setLimitBreakLabel(id);
			}

			setLevelLabel(id);

			document.getElementById("input_awakening").max = 4;
			document.getElementById("hint_awakening").textContent = `${document.getElementById("input_awakening").min}~${document.getElementById("input_awakening").max
				}`;
			if (wholeData[currentDisplayCategory][id]["Stars_Max"] > 3) {
				document.getElementById("pc_awakeningInput").classList.remove("hidden");
			} else {
				document.getElementById("pc_awakeningInput").classList.add("hidden");
			}

			if (currentDisplayCategory === "Monster" && wholeData[currentDisplayCategory][id]["Stars_Curr"] === 6) {
				document.getElementById("pc_cosmoInput").classList.remove("hidden");
			} else {
				document.getElementById("pc_cosmoInput").classList.add("hidden");
			}

			document.getElementById("input_boost").max = 300;
			document.getElementById("hint_boost").textContent = `${document.getElementById("input_boost").min}~${document.getElementById("input_boost").max
				}`;

			document.getElementById("input_refine").max = "100.00";
			document.getElementById("hint_refine").textContent = `${document.getElementById("input_refine").min}~${document.getElementById("input_refine").max
				}`;
			if (document.getElementById("input_level").value >= 40) {
				document.getElementById("input_refine").readOnly = false;
			} else {
				document.getElementById("input_refine").readOnly = true;
			}

			if (currentDisplayCategory === "Monster" && wholeData[currentDisplayCategory][id]["Stars_Max"] > 3) {
				document.getElementById("pc_masteryInput").classList.remove("hidden");
				document.getElementById("input_mastery").max = 40;
				document.getElementById("hint_mastery").textContent = `${document.getElementById("input_mastery").min}~${document.getElementById("input_mastery").max
					}`;
			} else {
				document.getElementById("pc_masteryInput").classList.add("hidden");
			}

			if (currentDisplayCategory === "Monster") {
				document.getElementById("checkbox_resultInvolvePassive").classList.remove("hidden");
			} else {
				document.getElementById("checkbox_resultInvolvePassive").classList.add("hidden");
			}
		}

		function setLimitBreakLabel(id) {
			id ??= currentDisplayID;
			document.getElementById("input_limitBreak").min =
				wholeData[currentDisplayCategory][id]["ExtraEvoInitialCount"] ?? 0;
			document.getElementById("input_limitBreak").max =
				wholeData[currentDisplayCategory][id]["Stars_Curr"] === wholeData[currentDisplayCategory][id]["Stars_Max"] ?
					Number(document.getElementById("input_limitBreak").min) + 5 :
					document.getElementById("input_limitBreak").min;
			document.getElementById("input_limitBreak").value = document.getElementById("input_limitBreak").min;
			document.getElementById("hint_limitBreak").textContent =
				document.getElementById("input_limitBreak").min === document.getElementById("input_limitBreak").max ?
					document.getElementById("input_limitBreak").min :
					`${document.getElementById("input_limitBreak").min}~${document.getElementById("input_limitBreak").max}`;
		}

		function setLevelLabel(id) {
			id ??= currentDisplayID;
			const currentLv = document.getElementById("input_level").value;
			document.getElementById("input_level").min = getLowestLV(id);
			document.getElementById("input_level").max = getHigestLV(id);
			document.getElementById("input_level").value =
				currentLv >= document.getElementById("input_level").min &&
					currentLv <= document.getElementById("input_level").max ?
					currentLv :
					document.getElementById("input_level").min;
			document.getElementById("hint_level").textContent = `${document.getElementById("input_level").min}~${document.getElementById("input_level").max
				}`;
		}

		function getLowestLV(id) {
			let lv = 1;
			const limitBreakValue = document.getElementById("input_limitBreak").value;
			if (limitBreakValue == 0) {
				preID = id.slice(0, -2) + String(Number(id.slice(-2)) - 1).padStart(2, "0");
				lv = wholeData[currentDisplayCategory]?.[preID]?.["FreeEvolve"]?.["EvolveLevel"] ?? 1;
			} else if (limitBreakValue == document.getElementById("input_limitBreak").min) {
				lv = getMaxLv(
					wholeData[currentDisplayCategory][id]["Stars_Curr"] - 1,
					wholeData[currentDisplayCategory][id]["Stars_Max"],
					0
				);
			} else {
				lv = getMaxLv(
					wholeData[currentDisplayCategory][id]["Stars_Curr"],
					wholeData[currentDisplayCategory][id]["Stars_Max"],
					limitBreakValue - Number(document.getElementById("input_limitBreak").min) - 1
				);
			}
			return lv;
		}

		function getHigestLV(id) {
			let lv =
				wholeData[currentDisplayCategory]?.[id]?.["FreeEvolve"]?.["EvolveLevel"] ??
				getMaxLv(
					wholeData[currentDisplayCategory][id]["Stars_Curr"],
					wholeData[currentDisplayCategory][id]["Stars_Max"],
					document.getElementById("input_limitBreak").value - Number(document.getElementById("input_limitBreak").min)
				);
			return lv;
		}

		function getMaxLv(currStars, maxStars, extraEvolves) {
			let level = 30;
			if (currStars <= 3) {
				if (currStars === 3 && maxStars === 4) {
					level = 50;
				} else {
					level = 30;
				}
			} else {
				if (currStars === 4) level = 60;
				if (currStars === 5) level = 80;
				if (currStars === 6) level = 100;

				if (currStars === maxStars || nowInfiniteMode) level += 20 * extraEvolves;
			}

			return level;
		}

		document.getElementById("input_atkBase").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			v = Math.max(v, minV);
			this.value = v;
		});

		document.getElementById("input_hpBase").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			v = Math.max(v, minV);
			this.value = v;
		});

		document.getElementById("input_starsCurrent").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
		});

		document.getElementById("input_starsMax").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
		});

		document.getElementById("input_limitBreak").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
			if (!nowInfiniteMode) {
				setLevelLabel();
				if (document.getElementById("input_level").value >= 40 || nowInfiniteMode) {
					document.getElementById("input_refine").readOnly = false;
				} else {
					document.getElementById("input_refine").readOnly = true;
					document.getElementById("input_refine").value = document.getElementById("input_refine").min;
				}
			}
		});

		document.getElementById("input_level").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = !nowInfiniteMode ? this.min : 1;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
			if (v >= 40 || nowInfiniteMode) {
				document.getElementById("input_refine").readOnly = false;
			} else {
				document.getElementById("input_refine").readOnly = true;
				document.getElementById("input_refine").value = document.getElementById("input_refine").min;
			}
			checkCosmoUnlock();
		});

		document.getElementById("input_awakening").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
			checkCosmoUnlock();
		});

		function checkCosmoUnlock() {
			if (
				(document.getElementById("input_awakening").value >= 4 &&
					document.getElementById("input_level").value >= 100) ||
				nowInfiniteMode
			) {
				document.getElementById("input_cosmo").disabled = false;
			} else {
				document.getElementById("input_cosmo").disabled = true;
				document.getElementById("input_cosmo").checked = false;
			}
		}

		document.getElementById("input_boost").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
		});

		document.getElementById("input_mastery").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
		});

		document.getElementById("input_refine").addEventListener("change", function () {
			let v = Number(this.value);
			if (isNaN(v)) v = this.min;
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			let [i = "0", f = "0"] = String(v).split(".");
			this.value = Number(`${i}.${f.slice(0, 2)}`).toFixed(2);
		});

		document.getElementById("infiniteMode").addEventListener("change", function () {
			if (this.checked) {
				nowInfiniteMode = true;
				document.getElementById("input_atkBase").readOnly = false;
				document.getElementById("hint_atkBase").classList.remove("hidden");

				document.getElementById("input_hpBase").readOnly = false;
				document.getElementById("hint_hpBase").classList.remove("hidden");

				document.getElementById("input_starsCurrent").readOnly = false;
				document.getElementById("hint_starsCurrent").classList.remove("hidden");

				document.getElementById("input_starsMax").readOnly = false;
				document.getElementById("hint_starsMax").classList.remove("hidden");

				document.getElementById("pc_limitBreakInput").classList.remove("hidden");
				document.getElementById("input_limitBreak").max = Infinity;
				document.getElementById("hint_limitBreak").textContent = `${document.getElementById("input_limitBreak").min
					}~`;

				document.getElementById("input_level").min = 1;
				document.getElementById("input_level").max = Infinity;
				document.getElementById("hint_level").textContent = `${document.getElementById("input_level").min}~`;

				document.getElementById("pc_awakeningInput").classList.remove("hidden");
				document.getElementById("input_awakening").max = Infinity;
				document.getElementById("hint_awakening").textContent = `${document.getElementById("input_awakening").min}~`;

				document.getElementById("input_boost").max = Infinity;
				document.getElementById("hint_boost").textContent = `${document.getElementById("input_boost").min}~`;

				document.getElementById("input_refine").max = Infinity;
				document.getElementById("hint_refine").textContent = `${document.getElementById("input_refine").min}~`;
				document.getElementById("input_refine").readOnly = false;

				if (currentDisplayCategory === "Monster") {
					document.getElementById("pc_cosmoInput").classList.remove("hidden");
					document.getElementById("input_cosmo").disabled = false;

					document.getElementById("input_mastery").max = Infinity;
					document.getElementById("hint_mastery").textContent = `${document.getElementById("input_mastery").min}~`;
					document.getElementById("pc_masteryInput").classList.remove("hidden");
				}
			} else {
				nowInfiniteMode = false;
				initStatsInput();
			}
		});

		document.getElementById("button_maxStats").addEventListener("click", function () {
			const id = currentDisplayID;
			document.getElementById("input_atkBase").value = wholeData[currentDisplayCategory][id]["Atk_Base"];
			document.getElementById("input_hpBase").value = wholeData[currentDisplayCategory][id]["Hp_Base"];
			document.getElementById("input_starsCurrent").value = wholeData[currentDisplayCategory][id]["Stars_Curr"];
			document.getElementById("input_starsMax").value = wholeData[currentDisplayCategory][id]["Stars_Max"];

			document.getElementById("input_limitBreak").value =
				wholeData[currentDisplayCategory][id]["Stars_Max"] > 3 ?
					wholeData[currentDisplayCategory][id]["Stars_Curr"] === wholeData[currentDisplayCategory][id]["Stars_Max"] ?
						Number(document.getElementById("input_limitBreak").min) + 5 :
						document.getElementById("input_limitBreak").min :
					0;
			if (!nowInfiniteMode) {
				document.getElementById("input_level").min = getLowestLV(id);
				document.getElementById("input_level").max = getHigestLV(id);
				document.getElementById("hint_level").textContent = `${document.getElementById("input_level").min}~${document.getElementById("input_level").max
					}`;
			}

			document.getElementById("input_level").value =
				wholeData[currentDisplayCategory]?.[id]?.["FreeEvolve"]?.["EvolveLevel"] ??
				getMaxLv(
					wholeData[currentDisplayCategory][id]["Stars_Curr"],
					wholeData[currentDisplayCategory][id]["Stars_Max"],
					document.getElementById("input_limitBreak").value - Number(document.getElementById("input_limitBreak").min)
				);

			document.getElementById("input_awakening").value =
				wholeData[currentDisplayCategory][id]["Stars_Max"] > 3 ? 4 : 0;

			if (currentDisplayCategory === "Monster" && wholeData[currentDisplayCategory][id]["Stars_Curr"] === 6) {
				document.getElementById("input_cosmo").checked = true;
				document.getElementById("input_cosmo").disabled = false;
			} else {
				document.getElementById("input_cosmo").checked = false;
			}

			document.getElementById("input_boost").value = 300;

			if (document.getElementById("input_level").value >= 40) {
				document.getElementById("input_refine").value = "100.00";
				document.getElementById("input_refine").readOnly = false;
			} else {
				document.getElementById("input_refine").value = "0.00";
			}

			document.getElementById("input_mastery").value =
				currentDisplayCategory === "Monster" && wholeData[currentDisplayCategory][id]["Stars_Max"] > 3 ? 40 : 0;
		});

		document.getElementById("button_calcPower").addEventListener("click", function () {
			const id = currentDisplayID;
			const isWeapon = currentDisplayCategory === "Weapon" ? true : false;
			const statsInput = {
				baseAtk: Number(document.getElementById("input_atkBase").value),
				baseHp: Number(document.getElementById("input_hpBase").value),
				starsCurrent: Number(document.getElementById("input_starsCurrent").value),
				starsMax: Number(document.getElementById("input_starsMax").value),
				extraEvolves: document.getElementById("input_limitBreak").value - document.getElementById("input_limitBreak").min,
				level: Number(document.getElementById("input_level").value),
				awakening: Number(document.getElementById("input_awakening").value),
				isCosmo: document.getElementById("input_cosmo").checked,
				boost: Number(document.getElementById("input_boost").value),
				refine: Number(document.getElementById("input_refine").value) * 100,
				mastery: Number(document.getElementById("input_mastery").value),
			};

			if (isWeapon) {
				let [reslutAtk, resultHp] = [
					Math.floor(calculateStatAprox(true, isWeapon, false, statsInput)),
					Math.floor(calculateStatAprox(false, isWeapon, false, statsInput)),
				];
				document.getElementById("result_atk").dataset.trueval = reslutAtk;
				document.getElementById("result_hp").dataset.trueval = resultHp;

				document.getElementById("result_atk").value = reslutAtk.toLocaleString();
				document.getElementById("result_hp").value = resultHp.toLocaleString();
			} else {
				let [reslutAtk, resultHp] = [
					bankersRound(calculateStatAprox(true, isWeapon, false, statsInput)),
					bankersRound(calculateStatAprox(false, isWeapon, false, statsInput)),
				];
				document.getElementById("result_atk").dataset.trueval = reslutAtk;
				document.getElementById("result_hp").dataset.trueval = resultHp;

				let [bonusAtk, bonusHp] = [0, 0];
				for (let i = 0; i <= statsInput.awakening; i++) {
					bonusAtk += wholeData[currentDisplayCategory][id]["PassiveBonusVisible"]?.[i]?.["Attack"] ?? 0;
					bonusHp += wholeData[currentDisplayCategory][id]["PassiveBonusVisible"]?.[i]?.["MaxHP"] ?? 0;
				}
				document.getElementById("result_atk").dataset.awkbonus = bonusAtk;
				document.getElementById("result_hp").dataset.awkbonus = bonusHp;

				const hasPassiveBonus = document.getElementById("resultInvolvePassive").checked;
				document.getElementById("result_atk").value = (reslutAtk += hasPassiveBonus ? bonusAtk : 0).toLocaleString();
				document.getElementById("result_hp").value = (resultHp += hasPassiveBonus ? bonusHp : 0).toLocaleString();
			}
			document.getElementById("result_power").value = calculateFinalPower(
				Math.floor(calculateStatAprox(true, isWeapon, true, statsInput)),
				Math.floor(calculateStatAprox(false, isWeapon, true, statsInput)),
				isWeapon,
				statsInput.mastery,
				statsInput.starsMax
			).toLocaleString();
		});

		function calculateStatAprox(isAtk, isWeapon, forPower, statsForCalc) {
			const baseStat = isAtk ? statsForCalc.baseAtk : statsForCalc.baseHp;
			let statVal = 0;
			statVal =
				baseStat *
				(1 + (statsForCalc.level - 30) * 0.025) *
				(statsForCalc.extraEvolves * 0.08 + 1) *
				(statsForCalc.refine / 10000 + 1);

			if (forPower) {
				statVal_temp1 = statVal * getBonus_Awakening(isWeapon, statsForCalc.awakening, statsForCalc.starsMax);
				statVal_temp2 = statVal + getMultiplier_Awakening(isAtk, statsForCalc.starsMax) * statsForCalc.awakening;
				statVal = Math.max(statVal_temp1, statVal_temp2);
			} else {
				statVal *= getBonus_Awakening(isWeapon, statsForCalc.awakening, statsForCalc.starsMax);
			}

			statVal += getBonus_Boost(isAtk, isWeapon, statsForCalc.boost);

			if (!isWeapon && statsForCalc.isCosmo) {
				const extraEvolvesForMaxLv = statsForCalc.starsMax > 3 ? 5 : 0;
				statVal +=
					baseStat *
					(1 + (getMaxLv(statsForCalc.starsCurrent, statsForCalc.starsMax, extraEvolvesForMaxLv) - 30) * 0.025) *
					((statsForCalc.refine / 10000 + 1) * 0.07);
			}

			return statVal;
		}

		function getBonus_Awakening(isWeapon, awakening, maxStar) {
			switch (maxStar) {
				case 4:
					return awakening * 0.05 + 1;
				case 5:
					return awakening * 0.075 + 1;
				case 6:
					if (isWeapon) {
						switch (awakening) {
							case 0:
								return 1;
							case 1:
								return 1.19;
							case 2:
								return 1.33;
							case 3:
								return 1.44;
							default:
								return 1.55;
						}
					} else {
						switch (awakening) {
							case 0:
								return 1;
							case 1:
								return 1.22;
							case 2:
								return 1.44;
							case 3:
								return 1.66;
							default:
								return 1.88;
						}
					}
				default:
					return 1;
			}
		}

		function getMultiplier_Awakening(isAtk, maxStar) {
			switch (maxStar) {
				case 6:
					return isAtk ? 248 : 1239;
				case 5:
					return isAtk ? 82 : 412;
				case 4:
					return isAtk ? 40 : 201;
				default:
					return 0;
			}
		}

		function getBonus_Boost(isAtk, isWeapon, boost) {
			const boost_lowerPart = boost > 90 ? 90 : boost;
			const boost_upperPart = boost > 90 ? boost - 90 : 0;

			const weight_lower = isAtk ? 3 : 14;
			const weight_upper = isAtk ? (isWeapon ? 3 : 73) : isWeapon ? 14 : 311;

			return weight_lower * boost_lowerPart + weight_upper * boost_upperPart;
		}

		function bankersRound(v) {
			let intPart = Math.floor(v);
			let fracPart = v - intPart;

			if (Math.abs(fracPart) !== 0.5) {
				return Math.round(v);
			} else {
				return intPart % 2 === 0 ? intPart : intPart + (v > 0 ? 1 : -1);
			}
		}

		function calculateFinalPower(trueAtk, trueHp, isWeapon, masteryLevel, maxStar) {
			let powerVal = 0;
			powerVal = trueAtk * 30 + trueHp * 6;
			if (!isWeapon) {
				powerVal *= 1 + masteryLevel * 0.005;
				switch (maxStar) {
					case 6:
						powerVal *= 2;
						break;
					case 5:
						powerVal *= 1.5;
						break;
				}
			}
			return bankersRound(powerVal);
		}

		document.getElementById("resultInvolvePassive").addEventListener("change", function () {
			if (document.getElementById("result_atk").value !== "" && document.getElementById("result_hp").value !== "") {
				const [reslutAtk, resultHp] = [
					Number(document.getElementById("result_atk").dataset.trueval),
					Number(document.getElementById("result_hp").dataset.trueval),
				];
				const [bonusAtk, bonusHp] = document.getElementById("resultInvolvePassive").checked ?
					[
						Number(document.getElementById("result_atk").dataset.awkbonus),
						Number(document.getElementById("result_hp").dataset.awkbonus),
					] :
					[0, 0];

				document.getElementById("result_atk").value = (reslutAtk + bonusAtk).toLocaleString();
				document.getElementById("result_hp").value = (resultHp + bonusHp).toLocaleString();
			}
		});
	</script>
</body>

</html>